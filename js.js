function e(e,t,n,r,o,a,l){try{var i=e[a](l),s=i.value}catch(e){n(e);return}i.done?t(s):Promise.resolve(s).then(r,o)}function t(t){return function(){var n=this,r=arguments;return new Promise(function(o,a){var l=t.apply(n,r);function i(t){e(l,o,a,i,s,"next",t)}function s(t){e(l,o,a,i,s,"throw",t)}i(void 0)})}}t(function*(){let e=e=>e,n=(performance.now(),document.currentScript.outerHTML),r=document.body.innerHTML.replace(n,""),o=0;function a(e){return e>=0?2*e:-2*e-1}function l(e){return e%2==0?e/2:-(e+1)/2}function i(){return(i=t(function*(e){let t=yield fetch(e);if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);return yield t.text()})).apply(this,arguments)}function s(e){return c.apply(this,arguments)}function c(){return(c=t(function*(e){return(yield function(e){return i.apply(this,arguments)}(e)).split("\n").filter(e=>!e.startsWith("#")).map(e=>e.trim())})).apply(this,arguments)}e(function(e){let t=function(e){let t=Math.floor((Math.sqrt(8*e+1)-1)/2),n=e-(t*t+t)/2;return[t-n,n]}(a(42));return[l(t[0]),l(t[1])]}(0));let d=yield s("/data/wordsets.txt"),u=[];function m(){return(m=t(function*(e){let t=yield s(`/data/wordsets/${e}.txt`);return u.push(t),t})).apply(this,arguments)}function p(e){return f.apply(this,arguments)}function f(){return(f=t(function*(e){var t;let n=e%d.length;return null!==(t=u[n])&&void 0!==t?t:yield function(e){return m.apply(this,arguments)}(d[n])})).apply(this,arguments)}let h=[],g={s1:0,s2:0,setSeed(e){this.s1=e,this.s2=e},random(){return this.s1=1103515245*this.s1+12345&2147483647,this.s2^=this.s2<<13,this.s2^=this.s2>>17,this.s2^=this.s2<<5,e("random.random"),e(((this.s1^this.s2)+2147483648)/4294967295)}};function y(){requestIdleCallback(()=>{v()})}function v(){S("gameState")&&O("gameState",serializeGameState())}let b=["keyup","pointerup","pointercancel","scrollend"];function E(){return w.apply(this,arguments)}function w(){return(w=t(function*(){let t;if(window.hwgInitialized)throw Error("Game was already initialized.");window.hwgInitialized=!0;let n=document.getElementById("stage"),r=[[3,2,1],[4,-1,0],[5,6,7]],[i,s,c]=[..."각".normalize("NFD")],d=12623-s.charCodeAt(0),u=Object.fromEntries(Object.entries({ㄱㄱ:"ㄲ",ㄱㅅ:"ㄳ",ㄴㅈ:"ㄵ",ㄴㅎ:"ㄶ",ㄷㄷ:"ㄸ",ㄹㄱ:"ㄺ",ㄹㅁ:"ㄻ",ㄹㅂ:"ㄼ",ㄹㅅ:"ㄽ",ㄹㅌ:"ㄾ",ㄹㅍ:"ㄿ",ㄹㅎ:"ㅀ",ㅂㅂ:"ㅃ",ㅂㅅ:"ㅄ",ㅅㅅ:"ㅆ",ㅈㅈ:"ㅉ",ㅏㅣ:"ㅐ",ㅑㅣ:"ㅒ",ㅓㅣ:"ㅔ",ㅕㅣ:"ㅖ",ㅗㅏ:"ㅘ",ㅗㅏㅣ:"ㅙ",ㅗㅣ:"ㅚ",ㅜㅓ:"ㅝ",ㅜㅓㅣ:"ㅞ",ㅜㅣ:"ㅟ",ㅡㅣ:"ㅢ"}).map(([e,t])=>[t,e])),m=-1,f=1;try{(t=q(S("gameState")))&&(f=t.stageNumber,n.textContent=f)}catch(e){console.error(e),L("gameState")}n.textContent=f,h.length=0,h.push(...yield p(f));let E=function(e,t){let n=a(e),r=a(t);return l(.5*(n+r)*(n+r+1)+r)}(f,o);g.setSeed(E);let w=[...h];function x(e){return[...e.normalize("NFC")].flatMap(T)}let C=[];for(let e=0;e<16;e++)C.push(...w.splice(ee(0,w.length-1),1));w.length=0;let P=document.getElementById("word-list"),j=document.getElementById("word-template");C.forEach(e=>{let t=j.content.cloneNode(!0).querySelector("li");t.textContent=e,t.dataset.word=e,P.appendChild(t)});let I=document.getElementById("jamo-board"),B=document.getElementById("jamo-template");I.addEventListener("selectstart",e=>{e.preventDefault()});let A=!1;I.addEventListener("contextmenu",e=>{A||e.preventDefault(),A=!1});let k="ㄱㄴㄷㄹㅁㅂㅅㅇㅈㅊㅋㅌㅍㅎㅏㅑㅓㅕㅗㅛㅜㅠㅡㅣ";function $(e){return[...e].map(e=>e.charCodeAt()).reduce((e,t)=>(e>>>1|(1&e)<<15)^t,0)}function R(){return{GAME_VERSION:4,width:12,height:12,completions:Array.from(I.querySelectorAll(".completion-bar")).filter(e=>e!==em).map(e=>`${e.dataset.start},${e.dataset.end}`).join(),stageNumber:f}}function N(e=R()){let t=JSON.stringify(e);return`${t}|${$(t)}`}function q(e){if(null===e)return null;let[t,n]=e.split("|");if($(t)!==1*n)throw Error("saved game state is corrupted");let r=JSON.parse(t);if(4!==r.GAME_VERSION)throw Error("The saved game state is from a different version of the game.");return r.completions?r.completions=r.completions.split(",").map(Number).reduce((e,t)=>(e.length&&4!==e.at(-1).length||e.push([]),e.at(-1).push(t),e),[]):r.completions=[],r}function T(e){let[t,n,r]=[...e.normalize("NFD")].concat(["","",""]).slice(0,3);return["ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌㅍㅎ"[t.charCodeAt(0)-i.charCodeAt(0)],String.fromCharCode(n.charCodeAt(0)+d),r.length?"ㄱㄲㄳㄴㄵㄶㄷㄹㄺㄻㄼㄽㄾㄿㅀㅁㅂㅄㅅㅆㅇㅈㅊㅋㅌㅍㅎ"[r.charCodeAt(0)-c.charCodeAt(0)]:""].flatMap(e=>{var t;return[...null!==(t=u[e])&&void 0!==t?t:e]})}let D=()=>(e(D.name),e(k[ee(0,k.length-1)])),z=C.flatMap(e=>[...e.normalize("NFC")].flatMap(T)),F=()=>(e(F.name),e(z[ee(0,z.length-1)]));function V(e,t){t.classList.add("no-transition"),e(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.classList.remove("no-transition")})})}I.style.setProperty("--gap","0.75rem"),I.style.setProperty("--width",12),I.style.setProperty("--height",12),V(()=>{for(let e=0;e<144;e++){let e=B.content.cloneNode(!0).querySelector("i"),t=ee(0,1)?D():F();e.dataset.jamo=t,I.appendChild(e)}},I);let G=Array.from({length:144},()=>null),H=(e,t,n,o)=>{if(n<0||n>7)throw RangeError("direction must be 0 to 7");for(let a=-1;a<=1;a++)for(let l=-1;l<=1;l++)if(r[a+1][l+1]===n)return[e+l*o,t+a*o]},U=I.querySelectorAll("#jamo-board>i");U.forEach((e,t)=>{e.dataset.index=t});let J=(e,t,n,r)=>{let o=x(e);if(o.length>12&&o.length>12)throw RangeError("word too long for board");for(let e=0;e<o.length;e++){let[a,l]=H(t,n,r,e);if(a<0||a>=12||l<0||l>=12)return!1;let i=G[12*l+a];if(i&&i!==o[e])return!1}for(let e=0;e<o.length;e++){let[a,l]=H(t,n,r,e),i=o[e],s=12*l+a;G[s]=i,U[s].dataset.jamo=i}return!0};function X(e,t){var n;let r=null!==(n=X.cache)&&void 0!==n?n:X.cache=new Map;if(r.has(e))return r.get(e);let o=t();return r.set(e,o),o}function Y(e,t,n,r,o=null){let a=X(Y,()=>document.getElementById("completion-bar-template")),l=null!=o?o:a.content.cloneNode(!0).querySelector(".completion-bar");l.dataset.start=`${e},${t}`,l.dataset.end=`${n},${r}`;let i=Math.min(e,n),s=Math.max(e,n),c=Math.min(t,r),d=Math.max(t,r),u=(s-i+1)*2+.75*(s-i),p=(d-c+1)*2+.75*(d-c);return l.style.setProperty("--top",`${2*c+.75*c}rem`),l.style.setProperty("--left",`${2*i+.75*i}rem`),l.style.setProperty("--width",`${u}rem`),l.style.setProperty("--height",`${p}rem`),l.style.setProperty("--thick","2.25rem"),l.style.setProperty("--hypot",`${Math.hypot(u,p)+.25}rem`),l.style.setProperty("--angle",`${180*Math.atan2(Math.sign(r-t)*p,Math.sign(n-e)*u)/Math.PI}deg`),l.style.setProperty("--hue",m+Math.floor(43758.5453*Math.sin(12.9898*e+78.233*t)%1*et)*Math.floor(360/et)),l}I.style.setProperty("--size","2rem");let W=0,_=document.getElementById("stage-clear-dialog"),K=_.querySelector("#next-stage"),Q=_.querySelector("#cancel-next-stage");function Z(e,t){W++,e.style.setProperty("--hue",t.style.getPropertyValue("--hue")),e.classList.add("found"),16===W&&(_.showModal(),p(f+1))}function ee(t,n){return e(ee.name),e([t,n]),e(Math.floor(g.random()*(n-t+1))+t)}K.addEventListener("click",()=>{var e,t;o=0;let n=R();O("gameState",N((e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}({},n),t=t={completions:"",stageNumber:n.stageNumber+1},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e))),M()},{passive:!0}),Q.addEventListener("click",()=>{_.close()},{passive:!0});let et=16;m=ee(0,359);let en=Array.from({length:4},()=>16),er=64,eo=()=>{let e=ee(0,er-1),t=0;for(let n=0;n<4;n++)if(e<(t+=en[n]))return n};try{C.toSorted((e,t)=>x(t).length-x(e).length).forEach(e=>{let t,n,r;let a=0;for(;;){t=ee(0,11),n=ee(0,11);let l=((r=eo())+6)%8;if(J(e,t,n,l)){en[r]--,er--,16-en[r]>16/3&&(er-=en[r],en[r]=0);break}if(a>256)throw o++,Error("Failed to populate a word to the board. Try increasing the size of the board or reducing the number of words. Retrying...");a++}})}catch(e){console.error(e),M();return}t&&t.completions.forEach(([e,t,n,r])=>{!function(e,t,n,r){let o=Y(e,t,n,r),a=eg(eh(e,t,n,r));Z(P.querySelector(`li[data-word="${a}"]`),o),I.appendChild(o)}(e,t,n,r)});let ea=document.getElementById("dark-mode-toggle");ea.addEventListener("click",()=>{let e;let t=ea.dataset.mode,n=ea.dataset.modeOptions.split("|"),r=n[(n.indexOf(t)+1)%n.length];e=()=>{ea.dataset.mode=r,document.documentElement.dataset.mode=r},document.startViewTransition?document.startViewTransition(e):e(),localStorage.darkMode=r},{passive:!0});let el=localStorage.darkMode;el&&V(()=>{ea.dataset.mode=el,document.documentElement.dataset.mode=el},ea);let ei=new Proxy({value:!1},{set:(e,t,n)=>{if("value"===t&&"boolean"==typeof n)return Reflect.set(e,t,n)}}),es=[-1,-1],ec=-1,ed=[-1,-1];function eu(e,t){let[n,o]=e,[a,l]=t;if(!(n===a||o===l||Math.abs(n-a)===Math.abs(o-l)))return -1;let[i,s]=[a-n,l-o];return r[Math.sign(s)+1][Math.sign(i)+1]}let em=null;function ep(){if(!(-1!==es[0]&&-1!==es[1]))return;let e=null!==em,[t,n]=es,[r,o]=-1===ed[0]&&-1===ed[1]?[t,n]:ed;em=Y(t,n,r,o,em),e||I.appendChild(em)}function ef(e,t){let n=e<t?1:-1,r=[];for(let o=0;o<=Math.abs(t-e);o++)r.push(o*n+e);return r}function eh(e,t,n,r){let o=ef(e,n),a=ef(t,r);return Array.from({length:Math.max(o.length,a.length)},(n,r)=>{var l,i;return[null!==(l=o[r])&&void 0!==l?l:e,null!==(i=a[r])&&void 0!==i?i:t]}).map(([e,t])=>U[12*t+e].dataset.jamo).join("")}function eg(e){return C.find(t=>{let[n,r]=X(t,()=>{let e=x(t);return[e.join(""),e.toReversed().join("")]});return n===e||r===e})}function ey(e,t,n){return e<t?t-e:e>n?e-n:0}function ev(e,t){let[n,r,o,a,l,i]=function(){let e=U[0],t=U[1],n=U[12],r=e.getBoundingClientRect(),o=t.getBoundingClientRect(),a=n.getBoundingClientRect(),l=o.left-r.left,i=a.top-r.top,s=r.left;return[s,r.top,l,i,o.left-r.right,a.top-r.bottom]}(),[s,c]=[e-(n-l/2),t-(r-i/2)],[d,u]=[Math.floor(s/o),Math.floor(c/a)];return[d,u]}function eb(e,t,n){return Math.min(n,Math.max(t,e))}I.addEventListener("pointerdown",e=>{if(e.target.matches("#jamo-board>i")){if(ei.value=!0,(es=ev(e.clientX,e.clientY))[0]<0||es[0]>=12||es[1]<0||es[1]>=12){es=[-1,-1];return}ed=[-1,-1],ec=-1,ep()}},{passive:!0}),document.addEventListener("pointerup",e=>{A=2===e.button,ei.value=!1,es[0]===ed[0]&&es[1]===ed[1]?(null==em||em.remove(),em=null):-1!==ed[0]&&-1!==ed[1]&&function(e){try{if(null===e)return;let[t,n]=e.dataset.start.split(",").map(Number),[r,o]=e.dataset.end.split(",").map(Number);if(t===r&&n===o){e.remove();return}let a=eu([t,n],[r,o]);if(-1===a){e.remove();return}let l=eh(t,n,r,o),i=eg(l);if(i){let t=P.querySelector(`li[data-word="${i}"]`);t&&(t.classList.contains("found")?e.remove():Z(t,e))}else e.remove()}finally{em=null}}(em)},{passive:!0}),document.addEventListener("pointermove",e=>{if(!ei.value)return;e.preventDefault();let t=ev(e.clientX,e.clientY);if(t[0]=eb(t[0],0,11),t[1]=eb(t[1],0,11),es[0]===t[0]&&es[1]===t[1])return;let n=eu(es,t);if(-1!==n?(ed=t,ec=n):-1!==ed[0]&&-1!==ed[1]&&(ed=function(e,t,n){let[r,o]=e,[a,l]=t,[i,s]=[a-r,l-o],[c,d]=[a-r,l-o],[u,m]=[a-r,l-o];Math.abs(c)<Math.abs(d)?c=0:d=0,(u+m)%2&&(Math.abs(u)<Math.abs(m)?m-=Math.sign(m):u-=Math.sign(u));{let e=Math.abs(Math.abs(u)-Math.abs(m))/2;Math.abs(u)<Math.abs(m)?(u+=Math.sign(u)*e,m-=Math.sign(m)*e):(u-=Math.sign(u)*e,m+=Math.sign(m)*e)}let p=Math.abs(i-c)+Math.abs(s-d),f=Math.abs(i-u)+Math.abs(s-m);return p===f?n%2==0?[r+c,o+d]:[r+u,o+m]:p<f?[r+c,o+d]:[r+u,o+m]}(es,t,ec)),!(-1!==ed[0]&&-1!==ed[1]))return;let[r,o]=ed;if(r<0||r>=12||o<0||o>=12){let e=eu(es,[r,o]),t=ey(r,0,11),n=ey(o,0,11);[r,o]=H(r,o,e,-Math.max(t,n))}U[12*(ed=[r,o])[1]+ed[0]],ep()}),t||O("gameState",N()),window.serializeGameState=N;let eE=document.querySelector("main"),ew=()=>{let e=screen.availWidth,t=screen.availHeight;eE.style.transform="scale(1)",eE.style.margin="0";let{width:n,height:r}=eE.getBoundingClientRect(),o=Math.min(1,e/n,t/r);eE.style.transform=`scale(${o})`,eE.style.margin=`${r*(o-1)/2}px ${n*(o-1)/2}px`};function eM(e){let t=new Uint8Array(atob(e).split("").map(e=>e.charCodeAt(0)));return new TextDecoder().decode(t)}ew(),window.addEventListener("resize",ew,{passive:!0}),b.forEach(e=>{document.addEventListener(e,y,{passive:!0})}),window.addEventListener("beforeunload",()=>{v()},{passive:!0});let eS=document.getElementById("settings-panel"),eL=document.getElementById("export-game-state-plaintext");document.getElementById("show-settings-panel").addEventListener("click",()=>{var e;eS.showModal(),v(),eL.value=(e=S("gameState"),btoa(String.fromCharCode(...new TextEncoder().encode(e))))}),document.querySelectorAll("button[data-success-report]").forEach(e=>{e.addEventListener("click",()=>{if(!e.successReport){let t=document.getElementById("success-report-template").content.cloneNode(!0).querySelector("input");t.setCustomValidity(e.dataset.successReport),e.appendChild(t),e.successReport=t}e.successReport.reportValidity()})}),document.getElementById("copy-game-state-plaintext").addEventListener("click",()=>{navigator.clipboard.writeText(eL.value)}),document.getElementById("download-game-state-plaintext").addEventListener("click",()=>{let e=document.createElement("a"),t=new Blob([eL.value],{type:"text/plain"});e.href=URL.createObjectURL(t),e.download=`save-${new Date().toISOString().replace(/\D/g,"")}.hwgsave`,e.hidden=!0,document.body.appendChild(e),e.click(),e.remove(),URL.revokeObjectURL(e.href)});let eO=document.getElementById("import-game-state-plaintext"),ex=document.getElementById("file-wrapper");function eC(e){eO.setCustomValidity(e),eO.reportValidity()}document.getElementById("select-game-state-file").addEventListener("input",e=>{let t=e.target.files[0];ex.dataset.filename=t.name;let n=new FileReader;n.onload=e=>{let t=e.target.result;try{let e=eM(t);q(e)}catch(e){console.error("Failed to parse game state from file",e),eC("선택한 파일의 구문 분석에 실패했습니다.")}eO.value=t},n.readAsText(t)}),document.getElementById("apply-imported-game-state").addEventListener("click",()=>{try{let e=eM(eO.value);q(e),O("gameState",e),M()}catch(e){console.error("Failed to parse game state from text",e),eC("올바른 형식의 게임 상태 텍스트가 아닙니다.")}}),document.querySelectorAll("dialog").forEach(e=>{e.addEventListener("click",t=>{let n=e.getBoundingClientRect();e.open&&(n.left>t.clientX||n.right<t.clientX||n.top>t.clientY||n.bottom<t.clientY)&&(e.classList.remove("bump"),requestAnimationFrame(()=>{e.classList.add("bump")}))}),e.addEventListener("close",()=>{e.classList.remove("bump")})});let eP=null,ej=document.getElementById("clear-game-state");ej.addEventListener("contextmenu",e=>{e.preventDefault()}),ej.addEventListener("pointerdown",()=>{eP=setTimeout(()=>{L("gameState"),location.reload()},2e3)}),ej.addEventListener("pointerup",()=>{clearTimeout(eP)}),ej.addEventListener("pointerleave",()=>{clearTimeout(eP)}),document.querySelectorAll("form[method=dialog]>button[type=submit]").forEach(e=>{e.addEventListener("click",t=>{var n,r;t.preventDefault(),null===(r=e.closest("dialog"))||void 0===r||null===(n=r.close)||void 0===n||n.call(r)})}),performance.now()})).apply(this,arguments)}function M(){[...document.body.children].filter(e=>e!==document.currentScript).forEach(e=>e.remove()),document.body.innerHTML=r,window.hwgInitialized=!1,b.forEach(e=>{document.removeEventListener(e,y)}),E()}function S(e,t){let n=localStorage[e];return"string"==typeof n?JSON.parse(n):null!=t?t:null}function L(e){delete localStorage[e]}function O(e,t){localStorage[e]=JSON.stringify(t)}performance.now(),E()})();

//# sourceMappingURL=js.js.map