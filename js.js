function t(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function n(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e,r,o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var a=[],c=!0,l=!1;try{for(o=o.call(t);!(c=(e=o.next()).done)&&(a.push(e.value),!n||a.length!==n);c=!0);}catch(t){l=!0,r=t}finally{try{c||null==o.return||o.return()}finally{if(l)throw r}}return a}}(t,n)||r(t,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(n){return function(n){if(Array.isArray(n))return t(n)}(n)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||r(n)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(n,e){if(n){if("string"==typeof n)return t(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if("Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(n,e)}}performance.now();var o=!1,a=[],c=document.currentScript.outerHTML,l=document.body.innerHTML.replace(c,""),u="사과\n바나나\n포도\n딸기\n오렌지\n체리\n복숭아\n수박\n파인애플\n배\n레몬\n라즈베리\n블루베리\n키위\n망고\n참외\n아보카도\n석류\n자몽\n두리안\n코코넛\n라임\n자두\n무화과\n감\n살구\n상추\n양파\n당근\n감자\n토마토\n오이\n시금치\n호박\n콩\n옥수수\n파프리카\n브로콜리\n고구마\n아스파라거스\n샐러리\n양배추\n고추\n버섯\n마늘\n생강\n비트\n콜라비\n아티초크\n미역\n김\n호박\n피망\n죽순\n무\n고사리\n갓\n청경채\n케일\n취나물\n치커리\n미나리\n더덕\n토란\n귤\n대추\n파파야\n복분자\n유자\n부추\n매실\n호두\n가지\n노각".split("\n");performance.now(),function t(){if(o)throw Error("This function should not be called more than once.");o=!0;var r,c=[[3,2,1],[4,-1,0],[5,6,7]],s=n(e("각".normalize("NFD")),3),d=s[0],f=s[1],m=s[2],h=12623-f.charCodeAt(0),v=Object.fromEntries(Object.entries({ㄱㄱ:"ㄲ",ㄱㅅ:"ㄳ",ㄴㅈ:"ㄵ",ㄴㅎ:"ㄶ",ㄷㄷ:"ㄸ",ㄹㄱ:"ㄺ",ㄹㅁ:"ㄻ",ㄹㅂ:"ㄼ",ㄹㅅ:"ㄽ",ㄹㅌ:"ㄾ",ㄹㅍ:"ㄿ",ㄹㅎ:"ㅀ",ㅂㅂ:"ㅃ",ㅂㅅ:"ㅄ",ㅅㅅ:"ㅆ",ㅈㅈ:"ㅉ",ㅏㅣ:"ㅐ",ㅑㅣ:"ㅒ",ㅓㅣ:"ㅔ",ㅕㅣ:"ㅖ",ㅗㅏ:"ㅘ",ㅗㅏㅣ:"ㅙ",ㅗㅣ:"ㅚ",ㅜㅓ:"ㅝ",ㅜㅓㅣ:"ㅞ",ㅜㅣ:"ㅟ",ㅡㅣ:"ㅢ"}).map(function(t){var e=n(t,2),r=e[0];return[e[1],r]}));try{w=function(t){if(null===t)return null;var e=n(t.split("|"),5),r=e[0],o=e[1],a=e[2],c=e[3],l=e[4];if(L("".concat(r,"|").concat(o,"|").concat(a,"|").concat(c))!==1*l||c.length!==o*a)throw Error("saved game state is corrupted");return[r.split(","),1*o,1*a,c]}((M=localStorage.gameState,"string"==typeof M?JSON.parse(M):null))}catch(t){console.error(t),delete localStorage.gameState}var y=e(u);function p(t){return e(t.normalize("NFC")).flatMap(N)}var g=w?w[0]:[];if(!w){for(var b,M,w,S=0;S<16;S++)g.push.apply(g,e(y.splice(D(0,y.length-1),1)));y.length=0}var E=document.getElementById("word-list"),A=document.getElementById("word-template");g.forEach(function(t){var n=A.content.cloneNode(!0).querySelector("li");n.textContent=t,n.dataset.word=t,E.appendChild(n)});var C=document.getElementById("jamo-board"),P=document.getElementById("jamo-template");C.addEventListener("selectstart",function(t){t.preventDefault()});var x=!1;C.addEventListener("contextmenu",function(t){x||t.preventDefault(),x=!1});var z="ㄱㄴㄷㄹㅁㅂㅅㅇㅈㅊㅋㅌㅍㅎㅏㅑㅓㅕㅗㅛㅜㅠㅡㅣ";function L(t){return e(t).map(function(t){return t.charCodeAt()}).reduce(function(t,n){return(t>>>1|(1&t)<<15)^n},0)}function I(){var t=g.join(),n=Array.from({length:144},function(t,n){return q[n].textContent}).join(""),e="".concat(t,"|").concat(12,"|").concat(12,"|").concat(n);return"".concat(e,"|").concat(L(e))}function N(t){var r=n(e(t.normalize("NFD")).concat(["","",""]).slice(0,3),3),o=r[0],a=r[1],c=r[2];return["ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌㅍㅎ"[o.charCodeAt(0)-d.charCodeAt(0)],String.fromCharCode(a.charCodeAt(0)+h),c.length?"ㄱㄲㄳㄴㄵㄶㄷㄹㄺㄻㄼㄽㄾㄿㅀㅁㅂㅄㅅㅆㅇㅈㅊㅋㅌㅍㅎ"[c.charCodeAt(0)-m.charCodeAt(0)]:""].flatMap(function(t){var n;return e(null!==(n=v[t])&&void 0!==n?n:t)})}var T=g.flatMap(function(t){return e(t.normalize("NFC")).flatMap(N)});function B(t,n){n.classList.add("notransition"),t(),requestAnimationFrame(function(){requestAnimationFrame(function(){n.classList.remove("notransition")})})}C.style.setProperty("--gap","".concat(.75,"em")),C.style.setProperty("--width",12),C.style.setProperty("--height",12),B(function(){for(var t=0;t<144;t++){var n=P.content.cloneNode(!0).querySelector("i"),e=w?w[3][t]:D(0,1)?z[D(0,z.length-1)]:T[D(0,T.length-1)];n.textContent=e,C.appendChild(n)}},C);var F=Array.from({length:144},function(){return null}),k=function(t,n,e,r){if(e<0||e>7)throw RangeError("direction must be 0 to 7");if(r<0)throw RangeError("progress must be 0 or greater");for(;i<=1;i++)for(;j<=1;j++)if(c[0][0]===e)return[t+-1*r,n+-1*r]},q=C.querySelectorAll("#jamo-board>i");q.forEach(function(t,n){t.dataset.index=n});var O=function(t,e,r,o){var a=p(t);if(a.length>12&&a.length>12)throw RangeError("word too long for board");for(var c=0;c<a.length;c++){var l=n(k(e,r,o,c),2),u=l[0],s=l[1];if(u<0||u>=12||s<0||s>=12)return!1;var d=F[12*s+u];if(d&&d!==a[c])return!1}for(var f=0;f<a.length;f++){var m,h,v=n(k(e,r,o,f),2),y=v[0],g=v[1];0===f&&((m=[y,g])[0],m[1]),f===a.length-1&&((h=[y,g])[0],h[1]);var b=a[f],M=12*g+y;F[M]=b,q[M].textContent=b}return!0};function R(t,n){var e,r=null!==(e=R.cache)&&void 0!==e?e:R.cache=new Map;if(r.has(t))return r.get(t);var o=n();return r.set(t,o),o}function D(t,n){return Math.floor(Math.random()*(n-t+1))+t}C.style.setProperty("--size","".concat(2,"rem"));var H=D(0,359),V=Array.from({length:4},function(){return 16}),J=64,X=function(){for(var t=D(0,J-1),n=0,e=0;e<4;e++)if(t<(n+=V[e]))return e};if(!w)try{g.toSorted(function(t,n){return p(n).length-p(t).length}).forEach(function(t){for(var n,e,r,o=0;;){n=D(0,11),e=D(0,11);var a=((r=X())+6)%8;if(O(t,n,e,a)){V[r]--,J--,16-V[r]>16/3&&(J-=V[r],V[r]=0);break}if(o>256)throw"The board generation was stuck in impossible state, so the page was reloaded.";o++}})}catch(n){console.error(n),a.forEach(clearInterval),a.length=0,e(document.body.children).filter(function(t){return t!==document.currentScript}).forEach(function(t){return t.remove()}),document.body.innerHTML=l,o=!1,t();return}var Y=document.getElementById("dark-mode-toggle");Y.addEventListener("click",function(){var t,n=Y.dataset.mode,e=Y.dataset.modeOptions.split("|"),r=e[(e.indexOf(n)+1)%e.length];t=function(){Y.dataset.mode=r,document.documentElement.dataset.mode=r},document.startViewTransition?document.startViewTransition(t):t(),localStorage.darkMode=r});var G=localStorage.darkMode;G&&B(function(){Y.dataset.mode=G,document.documentElement.dataset.mode=G},Y);var U=new Proxy({value:!1},{set:function(t,n,e){if("value"===n&&"boolean"==typeof e)return Reflect.set(t,n,e)}}),W=[-1,-1],$=-1,K=[-1,-1];function Q(t){return[t%12,Math.floor(t/12)]}function Z(t,e){var r=n(t,2),o=r[0],a=r[1],l=n(e,2),u=l[0],s=l[1];if(!(o===u||a===s||Math.abs(o-u)===Math.abs(a-s)))return -1;var d=[u-o,s-a],f=d[0];return c[Math.sign(d[1])+1][Math.sign(f)+1]}var _=null;function tt(){if(-1!==W[0]&&-1!==W[1]){var t=null!==_,e=n(W,2),r=e[0],o=e[1],a=n(-1===K[0]&&-1===K[1]?[r,o]:K,2);_=function t(n,e,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=R(t,function(){return document.getElementById("completion-bar-template")}),l=null!=a?a:c.content.cloneNode(!0).querySelector(".completion-bar");l.dataset.start="".concat(n,",").concat(e),l.dataset.end="".concat(r,",").concat(o);var u=Math.sign(o-e),s=Math.min(n,r),d=Math.max(n,r),f=Math.min(e,o),m=Math.max(e,o),h=(d-s+1)*2+.75*(d-s),v=(m-f+1)*2+.75*(m-f);l.style.setProperty("--top","".concat(2*f+.75*f,"em")),l.style.setProperty("--left","".concat(2*s+.75*s,"em")),l.style.setProperty("--width","".concat(h,"em")),l.style.setProperty("--height","".concat(v,"em")),l.style.setProperty("--thick","".concat(2.25,"em")),l.style.setProperty("--hypot","".concat(Math.hypot(h,v)+.25,"em")),l.style.setProperty("--angle","".concat(180*Math.atan2(u*v,Math.sign(r-n)*h)/Math.PI,"deg"));var y=Math.floor(43758.5453*Math.sin(12.9898*n+78.233*e)%1*16)*Math.floor(22.5);return l.style.setProperty("--color","oklch(75% 75% ".concat(H+y,"deg)")),l}(r,o,a[0],a[1],_),t||C.appendChild(_)}}C.addEventListener("pointerdown",function(t){var n=document.elementFromPoint(t.clientX,t.clientY);n.matches("#jamo-board>i")&&(U.value=!0,W=Q(1*n.dataset.index),K=[-1,-1],$=-1,tt())}),document.addEventListener("pointerup",function(t){x=2===t.button,U.value=!1,-1!==K[0]&&-1!==K[1]&&(W[0]!==K[0]||W[1]!==K[1])&&function(t){try{if(null===t)return;var e=n(t.dataset.start.split(",").map(Number),2),r=e[0],o=e[1],a=n(t.dataset.end.split(",").map(Number),2),c=a[0],l=a[1];if(r===c&&o===l){t.remove();return}var u=Z([r,o],[c,l]);if(-1===u){t.remove();return}var s=function(t,n){for(var e=t<n?1:-1,r=[],o=0;o<=Math.abs(n-t);o+=1)r.push(o*e+t);return r},d=s(r,c),f=s(o,l),m=Math.max(d.length,f.length),h=Array.from({length:m},function(t,n){var e,a;return[null!==(e=d[n])&&void 0!==e?e:r,null!==(a=f[n])&&void 0!==a?a:o]}).map(function(t){var e=n(t,2),r=e[0];return q[12*e[1]+r].textContent}).join(""),v=g.find(function(t){var e=n(R(t,function(){var n=p(t);return[n.join(""),n.toReversed().join("")]}),2),r=e[0],o=e[1];return r===h||o===h});if(v){var y=E.querySelector('li[data-word="'.concat(v,'"]'));y&&(y.classList.contains("found")?t.remove():(y.style.setProperty("--color",t.style.getPropertyValue("--color")),y.classList.add("found")))}else t.remove()}finally{_=null}}(_)}),document.addEventListener("pointermove",function(t){if(U.value){t.preventDefault();var e=document.elementFromPoint(t.clientX,t.clientY);if(null==e?void 0:e.matches("#jamo-board>i")){var r,o,a,c,l,u,s,d,f,m,h,v,y,p,g,b,M,w,S,E,A=Q(1*e.dataset.index);if(W[0]===A[0]&&W[1]===A[1])return;var C=Z(W,A);-1!==C?(K=A,$=C):-1!==K[0]&&-1!==K[1]&&(r=W,o=$,c=(a=n(r,2))[0],l=a[1],m=(f=[(s=(u=n(A,2))[0])-c,(d=u[1])-l])[0],h=f[1],y=(v=[s-c,d-l])[0],p=v[1],b=(g=[s-c,d-l])[0],Math.abs(y)<Math.abs(p)?y=0:p=0,(b+(M=g[1]))%2&&(Math.abs(b)<Math.abs(M)?M-=Math.sign(M):b-=Math.sign(b)),w=Math.abs(Math.abs(b)-Math.abs(M))/2,Math.abs(b)<Math.abs(M)?(b+=Math.sign(b)*w,M-=Math.sign(M)*w):(b-=Math.sign(b)*w,M+=Math.sign(M)*w),K=(S=Math.abs(m-y)+Math.abs(h-p))===(E=Math.abs(m-b)+Math.abs(h-M))?o%2==0?[c+y,l+p]:[c+b,l+M]:S<E?[c+y,l+p]:[c+b,l+M]),-1!==K[0]&&-1!==K[1]&&(q[12*K[1]+K[0]],tt())}}}),w||(r=I(),localStorage.gameState=JSON.stringify(r)),window.serializeGameState=I;var tn=document.querySelector("main"),te=function(){console.log("resizeToFit");var t=screen.availWidth,n=screen.availHeight;E.style.zoom=1,C.style.zoom=1,tn.style.zoom=1;var e=E.getBoundingClientRect().width,r=C.getBoundingClientRect().width;E.style.zoom=Math.min(1,t/e),C.style.zoom=Math.min(1,t/r);var o=tn.getBoundingClientRect().height;tn.style.zoom=Math.min(1,n/o)};te(),window.addEventListener("resize",te),performance.now()}();
