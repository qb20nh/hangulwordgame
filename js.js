function t(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function n(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e,r,o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var a=[],c=!0,i=!1;try{for(o=o.call(t);!(c=(e=o.next()).done)&&(a.push(e.value),!n||a.length!==n);c=!0);}catch(t){i=!0,r=t}finally{try{c||null==o.return||o.return()}finally{if(i)throw r}}return a}}(t,n)||r(t,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(n){return function(n){if(Array.isArray(n))return t(n)}(n)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||r(n)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(n,e){if(n){if("string"==typeof n)return t(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if("Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(n,e)}}performance.now();var o=!1,a=[],c=document.currentScript.outerHTML,i=document.body.innerHTML.replace(c,""),u="사과\n바나나\n포도\n딸기\n오렌지\n체리\n복숭아\n수박\n파인애플\n배\n레몬\n라즈베리\n블루베리\n키위\n망고\n참외\n아보카도\n석류\n자몽\n두리안\n코코넛\n라임\n자두\n무화과\n감\n살구\n상추\n양파\n당근\n감자\n토마토\n오이\n시금치\n호박\n콩\n옥수수\n파프리카\n브로콜리\n고구마\n아스파라거스\n샐러리\n양배추\n고추\n버섯\n마늘\n생강\n비트\n콜라비\n아티초크\n미역\n김\n호박\n피망\n죽순\n무\n고사리\n갓\n청경채\n케일\n취나물\n치커리\n미나리\n더덕\n토란\n귤\n대추\n파파야\n복분자\n유자\n부추\n매실\n호두\n가지\n노각".split("\n");function l(t){delete localStorage[t]}performance.now(),function t(){if(o)throw Error("This function should not be called more than once.");o=!0;var r,c=n(e("각".normalize("NFD")),3),s=c[0],d=c[1],f=c[2],h=12623-d.charCodeAt(0),m=Object.fromEntries(Object.entries({ㄱㄱ:"ㄲ",ㄱㅅ:"ㄳ",ㄴㅈ:"ㄵ",ㄴㅎ:"ㄶ",ㄷㄷ:"ㄸ",ㄹㄱ:"ㄺ",ㄹㅁ:"ㄻ",ㄹㅂ:"ㄼ",ㄹㅅ:"ㄽ",ㄹㅌ:"ㄾ",ㄹㅍ:"ㄿ",ㄹㅎ:"ㅀ",ㅂㅂ:"ㅃ",ㅂㅅ:"ㅄ",ㅅㅅ:"ㅆ",ㅈㅈ:"ㅉ",ㅏㅣ:"ㅐ",ㅑㅣ:"ㅒ",ㅓㅣ:"ㅔ",ㅕㅣ:"ㅖ",ㅗㅏ:"ㅘ",ㅗㅏㅣ:"ㅙ",ㅗㅣ:"ㅚ",ㅜㅓ:"ㅝ",ㅜㅓㅣ:"ㅞ",ㅜㅣ:"ㅟ",ㅡㅣ:"ㅢ"}).map(function(t){var e=n(t,2),r=e[0];return[e[1],r]}));try{M=function(t){if(null===t)return null;var e=n(t.split("|"),5),r=e[0],o=e[1],a=e[2],c=e[3],i=e[4];if(P("".concat(r,"|").concat(o,"|").concat(a,"|").concat(c))!==1*i||c.length!==o*a)throw Error("saved game state is corrupted");return[r.split(","),1*o,1*a,c]}((b=localStorage.gameState,"string"==typeof b?JSON.parse(b):null))}catch(t){console.error(t),l("gameState")}var v=e(u);function g(t){return e(t.normalize("NFC")).flatMap(I)}var p=M?M[0]:[];if(!M){for(var y,b,M,w=0;w<16;w++)p.push.apply(p,e(v.splice(z(0,v.length-1),1)));v.length=0}var j=document.getElementById("word-list"),E=document.getElementById("word-template");p.forEach(function(t){var n=E.content.cloneNode(!0).querySelector("li");n.textContent=t,n.dataset.word=t,j.appendChild(n)});var S=document.getElementById("jamo-board"),A=document.getElementById("jamo-template");S.addEventListener("selectstart",function(t){t.preventDefault()});var C="ㄱㄴㄷㄹㅁㅂㅅㅇㅈㅊㅋㅌㅍㅎㅏㅑㅓㅕㅗㅛㅜㅠㅡㅣ";function P(t){return e(t).map(function(t){return t.charCodeAt()}).reduce(function(t,n){return(t>>>1|(1&t)<<15)^n},0)}function x(){var t=p.join(),n=Array.from({length:144},function(t,n){return k[n].textContent}).join(""),e="".concat(t,"|").concat(12,"|").concat(12,"|").concat(n);return"".concat(e,"|").concat(P(e))}function I(t){var r=n(e(t.normalize("NFD")).concat(["","",""]).slice(0,3),3),o=r[0],a=r[1],c=r[2];return["ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌㅍㅎ"[o.charCodeAt(0)-s.charCodeAt(0)],String.fromCharCode(a.charCodeAt(0)+h),c.length?"ㄱㄲㄳㄴㄵㄶㄷㄹㄺㄻㄼㄽㄾㄿㅀㅁㅂㅄㅅㅆㅇㅈㅊㅋㅌㅍㅎ"[c.charCodeAt(0)-f.charCodeAt(0)]:""].flatMap(function(t){var n;return e(null!==(n=m[t])&&void 0!==n?n:t)})}window.composeIntoComposite=function(t){t=e(t);for(var r={cho:{ㄱ:["ㄱ","jung"],ㄴㄹㅁㅇㅊㅋㅌㅍㅎ:["jung"],ㄷ:["ㄷ","jung"],ㅂ:["ㅂ","jung"],ㅅ:["ㅅ","jung"],ㅈ:["ㅈ","jung"]},jung:{ㅏㅑㅓㅕㅡ:["ㅣ","jong"],ㅗ:["ㅏ","ㅣ","jong"],ㅛㅠㅣ:["jong"],ㅜ:["ㅓ","ㅣ","jong"]},jong:{ㄱ:["ㄱ","ㅅ","cho"],ㄴ:["ㅈ","ㅎ","cho"],ㄷㅁㅇㅈㅊㅋㅌㅍㅎ:["cho"],ㄹ:["ㄱ","ㅁ","ㅂ","ㅅ","ㅌ","ㅍ","ㅎ","cho"],ㅂ:["ㅅ","cho"],ㅅ:["ㅅ","cho"]}},o={cho:2,jung:3,jong:2},a={cho:0,jung:0,jong:0},c="cho",i=[],u=[],l=null;t[0];)!function(){var s=t.shift();u.push(s),a[c]++;var d=Object.entries(r[c]).find(function(t){var e=n(t,2),r=e[0];return e[1],r.includes(s)});if(!d)throw Error("cannot find suitable continuation for jamo sequence");var f=n(d,2),h=(f[0],f[1]);if(1===h.length||a[c]===o[c]){if(a[c]=0,c=h[0],i.push(e(u)),u.length=0,l&&!l.includes(s))throw Error("next candidate mismatch");l=null}else l=h.slice(0,-1)}();return i};var L=p.flatMap(function(t){return e(t.normalize("NFC")).flatMap(I)});function N(t,n){n.classList.add("notransition"),t(),requestAnimationFrame(function(){requestAnimationFrame(function(){n.classList.remove("notransition")})})}S.style.setProperty("--gap","".concat(.75,"em")),S.style.setProperty("--width",12),S.style.setProperty("--height",12),N(function(){for(var t=0;t<144;t++){var n=A.content.cloneNode(!0).querySelector("i"),e=M?M[3][t]:z(0,1)?C[z(0,C.length-1)]:L[z(0,L.length-1)];n.textContent=e,S.appendChild(n)}},S);var O=Array.from({length:144},function(){return null}),T=function(t,n,e,r){switch(e){case 0:return[t+r,n];case 1:return[t+r,n-r];case 2:return[t,n-r];case 3:return[t-r,n-r];case 4:return[t-r,n];case 5:return[t-r,n+r];case 6:return[t,n+r];case 7:return[t+r,n+r];default:throw RangeError("invalid direction")}},k=S.querySelectorAll("#jamo-board>i");k.forEach(function(t,n){t.dataset.index=n});var q=function(t,e,r,o){var a=g(t);if(a.length>12&&a.length>12)throw RangeError("word too long for board");for(var c=0;c<a.length;c++){var i=n(T(e,r,o,c),2),u=i[0],l=i[1];if(u<0||u>=12||l<0||l>=12)return!1;var s=O[12*l+u];if(s&&s!==a[c])return!1}for(var d=0;d<a.length;d++){var f,h,m=n(T(e,r,o,d),2),v=m[0],p=m[1];0===d&&((f=[v,p])[0],f[1]),d===a.length-1&&((h=[v,p])[0],h[1]);var y=a[d],b=12*p+v;O[b]=y,k[b].textContent=y}return!0};function F(t,n){var e,r=null!==(e=F.cache)&&void 0!==e?e:F.cache=new Map;if(r.has(t))return r.get(t);var o=n();return r.set(t,o),o}function z(t,n){return Math.floor(Math.random()*(n-t+1))+t}S.style.setProperty("--size","".concat(2,"rem"));var B=z(0,359),D=Array.from({length:4},function(){return 16}),H=64,R=function(){for(var t=z(0,H-1),n=0,e=0;e<4;e++)if(t<(n+=D[e]))return e};if(!M)try{p.toSorted(function(t,n){return g(n).length-g(t).length}).forEach(function(t){for(var n,e,r,o=0;;){n=z(0,11),e=z(0,11);var a=((r=R())+6)%8;if(q(t,n,e,a)){D[r]--,H--,16-D[r]>16/3&&(H-=D[r],D[r]=0);break}if(o>256)throw"The board generation was stuck in impossible state, so the page was reloaded.";o++}})}catch(n){console.error(n),a.forEach(clearInterval),a.length=0,e(document.body.children).filter(function(t){return t!==document.currentScript}).forEach(function(t){return t.remove()}),document.body.innerHTML=i,o=!1,t();return}var J=document.getElementById("dark-mode-toggle");J.addEventListener("click",function(){var t,n=J.dataset.mode,e=J.dataset.modeOptions.split("|"),r=e[(e.indexOf(n)+1)%e.length];t=function(){J.dataset.mode=r,document.documentElement.dataset.mode=r},document.startViewTransition?document.startViewTransition(t):t(),localStorage.darkMode=r});var V=localStorage.darkMode;V&&N(function(){J.dataset.mode=V,document.documentElement.dataset.mode=V},J);var X=new Proxy({value:!1},{set:function(t,n,e){if("value"===n&&"boolean"==typeof e)return e||console.log("pointerup"),Reflect.set(t,n,e)}}),Y=[-1,-1],G=-1,U=[-1,-1];function $(t){return[t%12,Math.floor(t/12)]}function K(t,e){var r=n(t,2),o=r[0],a=r[1],c=n(e,2),i=c[0],u=c[1];if(!(o===i||a===u||Math.abs(o-i)===Math.abs(a-u)))return -1;var l=[i-o,u-a],s=l[0];return[[3,2,1],[4,-1,0],[5,6,7]][Math.sign(l[1])+1][Math.sign(s)+1]}var Q=null;function W(){if(-1!==Y[0]&&-1!==Y[1]){var t=null!==Q,e=n(Y,2),r=e[0],o=e[1],a=n(-1===U[0]&&-1===U[1]?[r,o]:U,2);Q=function t(n,e,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=F(t,function(){return document.getElementById("completion-bar-template")}),i=null!=a?a:c.content.cloneNode(!0).querySelector(".completion-bar");i.dataset.start="".concat(n,",").concat(e),i.dataset.end="".concat(r,",").concat(o);var u=Math.sign(o-e),l=Math.min(n,r),s=Math.max(n,r),d=Math.min(e,o),f=Math.max(e,o),h=(s-l+1)*2+.75*(s-l),m=(f-d+1)*2+.75*(f-d);i.style.setProperty("--top","".concat(2*d+.75*d,"em")),i.style.setProperty("--left","".concat(2*l+.75*l,"em")),i.style.setProperty("--width","".concat(h,"em")),i.style.setProperty("--height","".concat(m,"em")),i.style.setProperty("--thick","".concat(2.25,"em")),i.style.setProperty("--hypot","".concat(Math.hypot(h,m)+.25,"em")),i.style.setProperty("--angle","".concat(180*Math.atan2(u*m,Math.sign(r-n)*h)/Math.PI,"deg"));var v=Math.floor(43758.5453*Math.sin(12.9898*n+78.233*e)%1*16)*Math.floor(22.5);return i.style.setProperty("--color","oklch(75% 75% ".concat(B+v,"deg)")),i}(r,o,a[0],a[1],Q),t||S.appendChild(Q)}}S.addEventListener("pointerdown",function(t){var n=document.elementFromPoint(t.clientX,t.clientY);n.matches("#jamo-board>i")&&(X.value=!0,Y=$(1*n.dataset.index),U=[-1,-1],G=-1,W())}),document.addEventListener("pointerup",function(t){X.value=!1,-1!==U[0]&&-1!==U[1]&&(Y[0]!==U[0]||Y[1]!==U[1])&&function(t){try{if(null===t)return;var e=n(t.dataset.start.split(",").map(Number),2),r=e[0],o=e[1],a=n(t.dataset.end.split(",").map(Number),2),c=a[0],i=a[1];if(r===c&&o===i){t.remove();return}var u=K([r,o],[c,i]);if(-1===u){t.remove();return}var l=function(t,n){for(var e=[],r=t;r<=n;r++)e.push(r);return e},s=l(r,c),d=l(o,i),f=Math.max(s.length,d.length),h=Array.from({length:f},function(t,n){var e,a;return[null!==(e=s[n])&&void 0!==e?e:r,null!==(a=d[n])&&void 0!==a?a:o]}).map(function(t){var e=n(t,2),r=e[0];return k[12*e[1]+r].textContent}).join(""),m=p.find(function(t){return F(t,function(){return g(t).join("")})===h});if(m){console.log("found word",m);var v=j.querySelector('li:is(:not(.found))[data-word="'.concat(m,'"]'));v&&v.classList.add("found")}else t.remove()}finally{Q=null}}(Q)}),document.addEventListener("pointermove",function(t){if(X.value){t.preventDefault();var e=document.elementFromPoint(t.clientX,t.clientY);if(null==e?void 0:e.matches("#jamo-board>i")){var r,o,a,c,i,u,l,s,d,f,h,m,v,g,p,y,b,M,w,j,E=$(1*e.dataset.index);if(Y[0]===E[0]&&Y[1]===E[1])return;var S=K(Y,E);-1!==S?(U=E,G=S):-1!==U[0]&&-1!==U[1]&&(r=Y,o=G,c=(a=n(r,2))[0],i=a[1],f=(d=[(l=(u=n(E,2))[0])-c,(s=u[1])-i])[0],h=d[1],v=(m=[l-c,s-i])[0],g=m[1],y=(p=[l-c,s-i])[0],Math.abs(v)<Math.abs(g)?v=0:g=0,(y+(b=p[1]))%2&&(Math.abs(y)<Math.abs(b)?b-=Math.sign(b):y-=Math.sign(y)),M=Math.abs(Math.abs(y)-Math.abs(b))/2,Math.abs(y)<Math.abs(b)?(y+=Math.sign(y)*M,b-=Math.sign(b)*M):(y-=Math.sign(y)*M,b+=Math.sign(b)*M),U=(w=Math.abs(f-v)+Math.abs(h-g))===(j=Math.abs(f-y)+Math.abs(h-b))?o%2==0?[c+v,i+g]:[c+y,i+b]:w<j?[c+v,i+g]:[c+y,i+b]),-1!==U[0]&&-1!==U[1]&&(k[12*U[1]+U[0]],W())}}}),M||(r=x(),localStorage.gameState=JSON.stringify(r)),window.serializeGameState=x,performance.now(),l("perfHistory")}(),window.addEventListener("load",function(){console.log("page loaded: ".concat(performance.now()-begin,"ms"))});
