function t(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function n(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e,r,o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(t);!(i=(e=o.next()).done)&&(a.push(e.value),!n||a.length!==n);i=!0);}catch(t){c=!0,r=t}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(t,n)||r(t,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(n){return function(n){if(Array.isArray(n))return t(n)}(n)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||r(n)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(n,e){if(n){if("string"==typeof n)return t(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if("Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(n,e)}}performance.now();var o=!1,a=[],i=document.currentScript.outerHTML,c=document.body.innerHTML.replace(i,""),u="사과\n바나나\n포도\n딸기\n오렌지\n체리\n복숭아\n수박\n파인애플\n배\n레몬\n라즈베리\n블루베리\n키위\n망고\n참외\n아보카도\n석류\n자몽\n두리안\n코코넛\n라임\n자두\n무화과\n감\n살구\n상추\n양파\n당근\n감자\n토마토\n오이\n시금치\n호박\n콩\n옥수수\n파프리카\n브로콜리\n고구마\n아스파라거스\n샐러리\n양배추\n고추\n버섯\n마늘\n생강\n비트\n콜라비\n아티초크\n미역\n김\n호박\n피망\n죽순\n무\n고사리\n갓\n청경채\n케일\n취나물\n치커리\n미나리\n더덕\n토란\n귤\n대추\n파파야\n복분자\n유자\n부추\n매실\n호두\n가지\n노각".split("\n");function l(t){delete localStorage[t]}performance.now(),function t(){if(o)throw Error("This function should not be called more than once.");o=!0;var r,i=n(e("각".normalize("NFD")),3),s=i[0],d=i[1],f=i[2],h=12623-d.charCodeAt(0),m=Object.fromEntries(Object.entries({ㄱㄱ:"ㄲ",ㄱㅅ:"ㄳ",ㄴㅈ:"ㄵ",ㄴㅎ:"ㄶ",ㄷㄷ:"ㄸ",ㄹㄱ:"ㄺ",ㄹㅁ:"ㄻ",ㄹㅂ:"ㄼ",ㄹㅅ:"ㄽ",ㄹㅌ:"ㄾ",ㄹㅍ:"ㄿ",ㄹㅎ:"ㅀ",ㅂㅂ:"ㅃ",ㅂㅅ:"ㅄ",ㅅㅅ:"ㅆ",ㅈㅈ:"ㅉ",ㅏㅣ:"ㅐ",ㅑㅣ:"ㅒ",ㅓㅣ:"ㅔ",ㅕㅣ:"ㅖ",ㅗㅏ:"ㅘ",ㅗㅏㅣ:"ㅙ",ㅗㅣ:"ㅚ",ㅜㅓ:"ㅝ",ㅜㅓㅣ:"ㅞ",ㅜㅣ:"ㅟ",ㅡㅣ:"ㅢ"}).map(function(t){var e=n(t,2),r=e[0];return[e[1],r]}));try{M=function(t){if(null===t)return null;var e=n(t.split("|"),5),r=e[0],o=e[1],a=e[2],i=e[3],c=e[4];if(P("".concat(r,"|").concat(o,"|").concat(a,"|").concat(i))!==1*c||i.length!==o*a)throw Error("saved game state is corrupted");return[r.split(","),1*o,1*a,i]}((b=localStorage.gameState,"string"==typeof b?JSON.parse(b):null))}catch(t){console.error(t),l("gameState")}var v=e(u);function g(t){return e(t.normalize("NFC")).flatMap(L)}var p=M?M[0]:[];if(!M){for(var y,b,M,w=0;w<16;w++)p.push.apply(p,e(v.splice(z(0,v.length-1),1)));v.length=0}var j=document.getElementById("word-list"),S=document.getElementById("word-template");p.forEach(function(t){var n=S.content.cloneNode(!0).querySelector("li");n.textContent=t,n.dataset.word=t,j.appendChild(n)});var E=document.getElementById("jamo-board"),C=document.getElementById("jamo-template");E.addEventListener("selectstart",function(t){t.preventDefault()});var A=!1;E.addEventListener("contextmenu",function(t){A||t.preventDefault(),A=!1});var x="ㄱㄴㄷㄹㅁㅂㅅㅇㅈㅊㅋㅌㅍㅎㅏㅑㅓㅕㅗㅛㅜㅠㅡㅣ";function P(t){return e(t).map(function(t){return t.charCodeAt()}).reduce(function(t,n){return(t>>>1|(1&t)<<15)^n},0)}function I(){var t=p.join(),n=Array.from({length:144},function(t,n){return T[n].textContent}).join(""),e="".concat(t,"|").concat(12,"|").concat(12,"|").concat(n);return"".concat(e,"|").concat(P(e))}function L(t){var r=n(e(t.normalize("NFD")).concat(["","",""]).slice(0,3),3),o=r[0],a=r[1],i=r[2];return["ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌㅍㅎ"[o.charCodeAt(0)-s.charCodeAt(0)],String.fromCharCode(a.charCodeAt(0)+h),i.length?"ㄱㄲㄳㄴㄵㄶㄷㄹㄺㄻㄼㄽㄾㄿㅀㅁㅂㅄㅅㅆㅇㅈㅊㅋㅌㅍㅎ"[i.charCodeAt(0)-f.charCodeAt(0)]:""].flatMap(function(t){var n;return e(null!==(n=m[t])&&void 0!==n?n:t)})}window.composeIntoComposite=function(t){t=e(t);for(var r={cho:{ㄱ:["ㄱ","jung"],ㄴㄹㅁㅇㅊㅋㅌㅍㅎ:["jung"],ㄷ:["ㄷ","jung"],ㅂ:["ㅂ","jung"],ㅅ:["ㅅ","jung"],ㅈ:["ㅈ","jung"]},jung:{ㅏㅑㅓㅕㅡ:["ㅣ","jong"],ㅗ:["ㅏ","ㅣ","jong"],ㅛㅠㅣ:["jong"],ㅜ:["ㅓ","ㅣ","jong"]},jong:{ㄱ:["ㄱ","ㅅ","cho"],ㄴ:["ㅈ","ㅎ","cho"],ㄷㅁㅇㅈㅊㅋㅌㅍㅎ:["cho"],ㄹ:["ㄱ","ㅁ","ㅂ","ㅅ","ㅌ","ㅍ","ㅎ","cho"],ㅂ:["ㅅ","cho"],ㅅ:["ㅅ","cho"]}},o={cho:2,jung:3,jong:2},a={cho:0,jung:0,jong:0},i="cho",c=[],u=[],l=null;t[0];)!function(){var s=t.shift();u.push(s),a[i]++;var d=Object.entries(r[i]).find(function(t){var e=n(t,2),r=e[0];return e[1],r.includes(s)});if(!d)throw Error("cannot find suitable continuation for jamo sequence");var f=n(d,2),h=(f[0],f[1]);if(1===h.length||a[i]===o[i]){if(a[i]=0,i=h[0],c.push(e(u)),u.length=0,l&&!l.includes(s))throw Error("next candidate mismatch");l=null}else l=h.slice(0,-1)}();return c};var N=p.flatMap(function(t){return e(t.normalize("NFC")).flatMap(L)});function q(t,n){n.classList.add("notransition"),t(),requestAnimationFrame(function(){requestAnimationFrame(function(){n.classList.remove("notransition")})})}E.style.setProperty("--gap","".concat(.75,"em")),E.style.setProperty("--width",12),E.style.setProperty("--height",12),q(function(){for(var t=0;t<144;t++){var n=C.content.cloneNode(!0).querySelector("i"),e=M?M[3][t]:z(0,1)?x[z(0,x.length-1)]:N[z(0,N.length-1)];n.textContent=e,E.appendChild(n)}},E);var B=Array.from({length:144},function(){return null}),O=function(t,n,e,r){switch(e){case 0:return[t+r,n];case 1:return[t+r,n-r];case 2:return[t,n-r];case 3:return[t-r,n-r];case 4:return[t-r,n];case 5:return[t-r,n+r];case 6:return[t,n+r];case 7:return[t+r,n+r];default:throw RangeError("invalid direction")}},T=E.querySelectorAll("#jamo-board>i");T.forEach(function(t,n){t.dataset.index=n});var k=function(t,e,r,o){var a=g(t);if(a.length>12&&a.length>12)throw RangeError("word too long for board");for(var i=0;i<a.length;i++){var c=n(O(e,r,o,i),2),u=c[0],l=c[1];if(u<0||u>=12||l<0||l>=12)return!1;var s=B[12*l+u];if(s&&s!==a[i])return!1}for(var d=0;d<a.length;d++){var f,h,m=n(O(e,r,o,d),2),v=m[0],p=m[1];0===d&&((f=[v,p])[0],f[1]),d===a.length-1&&((h=[v,p])[0],h[1]);var y=a[d],b=12*p+v;B[b]=y,T[b].textContent=y}return!0};function F(t,n){var e,r=null!==(e=F.cache)&&void 0!==e?e:F.cache=new Map;if(r.has(t))return r.get(t);var o=n();return r.set(t,o),o}function z(t,n){return Math.floor(Math.random()*(n-t+1))+t}E.style.setProperty("--size","".concat(2,"rem"));var R=z(0,359),D=Array.from({length:4},function(){return 16}),H=64,J=function(){for(var t=z(0,H-1),n=0,e=0;e<4;e++)if(t<(n+=D[e]))return e};if(!M)try{p.toSorted(function(t,n){return g(n).length-g(t).length}).forEach(function(t){for(var n,e,r,o=0;;){n=z(0,11),e=z(0,11);var a=((r=J())+6)%8;if(k(t,n,e,a)){D[r]--,H--,16-D[r]>16/3&&(H-=D[r],D[r]=0);break}if(o>256)throw"The board generation was stuck in impossible state, so the page was reloaded.";o++}})}catch(n){console.error(n),a.forEach(clearInterval),a.length=0,e(document.body.children).filter(function(t){return t!==document.currentScript}).forEach(function(t){return t.remove()}),document.body.innerHTML=c,o=!1,t();return}var V=document.getElementById("dark-mode-toggle");V.addEventListener("click",function(){var t,n=V.dataset.mode,e=V.dataset.modeOptions.split("|"),r=e[(e.indexOf(n)+1)%e.length];t=function(){V.dataset.mode=r,document.documentElement.dataset.mode=r},document.startViewTransition?document.startViewTransition(t):t(),localStorage.darkMode=r});var X=localStorage.darkMode;X&&q(function(){V.dataset.mode=X,document.documentElement.dataset.mode=X},V);var Y=new Proxy({value:!1},{set:function(t,n,e){if("value"===n&&"boolean"==typeof e)return Reflect.set(t,n,e)}}),G=[-1,-1],U=-1,W=[-1,-1];function $(t){return[t%12,Math.floor(t/12)]}function K(t,e){var r=n(t,2),o=r[0],a=r[1],i=n(e,2),c=i[0],u=i[1];if(!(o===c||a===u||Math.abs(o-c)===Math.abs(a-u)))return -1;var l=[c-o,u-a],s=l[0];return[[3,2,1],[4,-1,0],[5,6,7]][Math.sign(l[1])+1][Math.sign(s)+1]}var Q=null;function Z(){if(-1!==G[0]&&-1!==G[1]){var t=null!==Q,e=n(G,2),r=e[0],o=e[1],a=n(-1===W[0]&&-1===W[1]?[r,o]:W,2);Q=function t(n,e,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=F(t,function(){return document.getElementById("completion-bar-template")}),c=null!=a?a:i.content.cloneNode(!0).querySelector(".completion-bar");c.dataset.start="".concat(n,",").concat(e),c.dataset.end="".concat(r,",").concat(o);var u=Math.sign(o-e),l=Math.min(n,r),s=Math.max(n,r),d=Math.min(e,o),f=Math.max(e,o),h=(s-l+1)*2+.75*(s-l),m=(f-d+1)*2+.75*(f-d);c.style.setProperty("--top","".concat(2*d+.75*d,"em")),c.style.setProperty("--left","".concat(2*l+.75*l,"em")),c.style.setProperty("--width","".concat(h,"em")),c.style.setProperty("--height","".concat(m,"em")),c.style.setProperty("--thick","".concat(2.25,"em")),c.style.setProperty("--hypot","".concat(Math.hypot(h,m)+.25,"em")),c.style.setProperty("--angle","".concat(180*Math.atan2(u*m,Math.sign(r-n)*h)/Math.PI,"deg"));var v=Math.floor(43758.5453*Math.sin(12.9898*n+78.233*e)%1*16)*Math.floor(22.5);return c.style.setProperty("--color","oklch(75% 75% ".concat(R+v,"deg)")),c}(r,o,a[0],a[1],Q),t||E.appendChild(Q)}}E.addEventListener("pointerdown",function(t){var n=document.elementFromPoint(t.clientX,t.clientY);n.matches("#jamo-board>i")&&(Y.value=!0,G=$(1*n.dataset.index),W=[-1,-1],U=-1,Z())}),document.addEventListener("pointerup",function(t){A=2===t.button,Y.value=!1,-1!==W[0]&&-1!==W[1]&&(G[0]!==W[0]||G[1]!==W[1])&&function(t){try{if(null===t)return;var e=n(t.dataset.start.split(",").map(Number),2),r=e[0],o=e[1],a=n(t.dataset.end.split(",").map(Number),2),i=a[0],c=a[1];if(r===i&&o===c){t.remove();return}var u=K([r,o],[i,c]);if(-1===u){t.remove();return}var l=function(t,n){for(var e=[],r=t;r<=n;r++)e.push(r);return e},s=l(r,i),d=l(o,c),f=Math.max(s.length,d.length),h=Array.from({length:f},function(t,n){var e,a;return[null!==(e=s[n])&&void 0!==e?e:r,null!==(a=d[n])&&void 0!==a?a:o]}).map(function(t){var e=n(t,2),r=e[0];return T[12*e[1]+r].textContent}).join(""),m=p.find(function(t){return F(t,function(){return g(t).join("")})===h});if(m){var v=j.querySelector('li:is(:not(.found))[data-word="'.concat(m,'"]'));v&&v.classList.add("found")}else t.remove()}finally{Q=null}}(Q)}),document.addEventListener("pointermove",function(t){if(Y.value){t.preventDefault();var e=document.elementFromPoint(t.clientX,t.clientY);if(null==e?void 0:e.matches("#jamo-board>i")){var r,o,a,i,c,u,l,s,d,f,h,m,v,g,p,y,b,M,w,j,S=$(1*e.dataset.index);if(G[0]===S[0]&&G[1]===S[1])return;var E=K(G,S);-1!==E?(W=S,U=E):-1!==W[0]&&-1!==W[1]&&(r=G,o=U,i=(a=n(r,2))[0],c=a[1],f=(d=[(l=(u=n(S,2))[0])-i,(s=u[1])-c])[0],h=d[1],v=(m=[l-i,s-c])[0],g=m[1],y=(p=[l-i,s-c])[0],Math.abs(v)<Math.abs(g)?v=0:g=0,(y+(b=p[1]))%2&&(Math.abs(y)<Math.abs(b)?b-=Math.sign(b):y-=Math.sign(y)),M=Math.abs(Math.abs(y)-Math.abs(b))/2,Math.abs(y)<Math.abs(b)?(y+=Math.sign(y)*M,b-=Math.sign(b)*M):(y-=Math.sign(y)*M,b+=Math.sign(b)*M),W=(w=Math.abs(f-v)+Math.abs(h-g))===(j=Math.abs(f-y)+Math.abs(h-b))?o%2==0?[i+v,c+g]:[i+y,c+b]:w<j?[i+v,c+g]:[i+y,c+b]),-1!==W[0]&&-1!==W[1]&&(T[12*W[1]+W[0]],Z())}}}),M||(r=I(),localStorage.gameState=JSON.stringify(r)),window.serializeGameState=I;var _=screen.availWidth,tt=screen.availHeight,tn=j.getBoundingClientRect().width,te=E.getBoundingClientRect().width;j.style.scale=Math.min(1,_/tn),E.style.scale=Math.min(1,_/te);var tr=document.querySelector("main"),to=tr.getBoundingClientRect().height;tr.style.scale=Math.min(1,tt/to),performance.now(),l("perfHistory")}();
