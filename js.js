function t(t,e,n,r,o,a,l){try{var i=t[a](l),s=i.value}catch(t){n(t);return}i.done?e(s):Promise.resolve(s).then(r,o)}function e(e){return function(){var n=this,r=arguments;return new Promise(function(o,a){var l=e.apply(n,r);function i(e){t(l,o,a,i,s,"next",e)}function s(e){t(l,o,a,i,s,"throw",e)}i(void 0)})}}e(function*(){let t=t=>t,n=(performance.now(),document.currentScript.outerHTML),r=document.body.innerHTML.replace(n,""),o=0;function a(t){return t>=0?2*t:-2*t-1}function l(t){return t%2==0?t/2:-(t+1)/2}function i(){return(i=e(function*(t){let e=yield fetch(t);if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);return yield e.text()})).apply(this,arguments)}function s(t){return u.apply(this,arguments)}function u(){return(u=e(function*(t){return(yield function(t){return i.apply(this,arguments)}(t)).split("\n").filter(t=>!t.startsWith("#")).map(t=>t.trim())})).apply(this,arguments)}t(function(t){let e=function(t){let e=Math.floor((Math.sqrt(8*t+1)-1)/2),n=t-(e*e+e)/2;return[e-n,n]}(a(42));return[l(e[0]),l(e[1])]}(0));let c=yield s("/data/wordsets.txt"),d=[];function h(){return(h=e(function*(t){let e=yield s(`/data/wordsets/${t}.txt`);return d.push(e),e})).apply(this,arguments)}function f(){return(f=e(function*(t){var e;let n=t%c.length;return null!==(e=d[n])&&void 0!==e?e:yield function(t){return h.apply(this,arguments)}(c[n])})).apply(this,arguments)}let m=[],p={s1:0,s2:0,setSeed(t){this.s1=t,this.s2=t},random(){return this.s1=1103515245*this.s1+12345&2147483647,this.s2^=this.s2<<13,this.s2^=this.s2>>17,this.s2^=this.s2<<5,t("random.random"),t(((this.s1^this.s2)+2147483648)/4294967295)}};function g(){return y.apply(this,arguments)}function y(){return(y=e(function*(){let e;if(window.hwgInitialized)throw Error("Game was already initialized.");window.hwgInitialized=!0;let n=document.getElementById("stage"),r=[[3,2,1],[4,-1,0],[5,6,7]],[i,s,u]=[..."각".normalize("NFD")],c=12623-s.charCodeAt(0),d=Object.fromEntries(Object.entries({ㄱㄱ:"ㄲ",ㄱㅅ:"ㄳ",ㄴㅈ:"ㄵ",ㄴㅎ:"ㄶ",ㄷㄷ:"ㄸ",ㄹㄱ:"ㄺ",ㄹㅁ:"ㄻ",ㄹㅂ:"ㄼ",ㄹㅅ:"ㄽ",ㄹㅌ:"ㄾ",ㄹㅍ:"ㄿ",ㄹㅎ:"ㅀ",ㅂㅂ:"ㅃ",ㅂㅅ:"ㅄ",ㅅㅅ:"ㅆ",ㅈㅈ:"ㅉ",ㅏㅣ:"ㅐ",ㅑㅣ:"ㅒ",ㅓㅣ:"ㅔ",ㅕㅣ:"ㅖ",ㅗㅏ:"ㅘ",ㅗㅏㅣ:"ㅙ",ㅗㅣ:"ㅚ",ㅜㅓ:"ㅝ",ㅜㅓㅣ:"ㅞ",ㅜㅣ:"ㅟ",ㅡㅣ:"ㅢ"}).map(([t,e])=>[e,t])),h=-1,g=1;try{(e=function(t){if(null===t)return null;let[e,n]=t.split("|");if(x(e)!==1*n)throw Error("saved game state is corrupted");let r=JSON.parse(e);if(4!==r.GAME_VERSION)throw Error("The saved game state is from a different version of the game.");return r.completions?r.completions=r.completions.split(",").map(Number).reduce((t,e)=>(t.length&&4!==t.at(-1).length||t.push([]),t.at(-1).push(e),t),[]):r.completions=[],r}(v("gameState")))&&(g=e.stageNumber,n.textContent=g)}catch(t){console.error(t),delete localStorage.gameState}n.textContent=g,m.length=0,m.push(...yield function(t){return f.apply(this,arguments)}(g));let y=function(t,e){let n=a(t),r=a(e);return l(.5*(n+r)*(n+r+1)+r)}(g,o);p.setSeed(y);let M=[...m];function E(t){return[...t.normalize("NFC")].flatMap(k)}let S=[];for(let t=0;t<16;t++)S.push(...M.splice(Y(0,M.length-1),1));M.length=0;let O=document.getElementById("word-list"),P=document.getElementById("word-template");S.forEach(t=>{let e=P.content.cloneNode(!0).querySelector("li");e.textContent=t,e.dataset.word=t,O.appendChild(e)});let j=document.getElementById("jamo-board"),A=document.getElementById("jamo-template");j.addEventListener("selectstart",t=>{t.preventDefault()});let C=!1;j.addEventListener("contextmenu",t=>{C||t.preventDefault(),C=!1});let L="ㄱㄴㄷㄹㅁㅂㅅㅇㅈㅊㅋㅌㅍㅎㅏㅑㅓㅕㅗㅛㅜㅠㅡㅣ";function x(t){return[...t].map(t=>t.charCodeAt()).reduce((t,e)=>(t>>>1|(1&t)<<15)^e,0)}function $(){return{GAME_VERSION:4,width:12,height:12,completions:Array.from(j.querySelectorAll(".completion-bar")).filter(t=>t!==ti).map(t=>`${t.dataset.start},${t.dataset.end}`).join(),stageNumber:g}}function N(t=$()){let e=JSON.stringify(t);return`${e}|${x(e)}`}function k(t){let[e,n,r]=[...t.normalize("NFD")].concat(["","",""]).slice(0,3);return["ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌㅍㅎ"[e.charCodeAt(0)-i.charCodeAt(0)],String.fromCharCode(n.charCodeAt(0)+c),r.length?"ㄱㄲㄳㄴㄵㄶㄷㄹㄺㄻㄼㄽㄾㄿㅀㅁㅂㅄㅅㅆㅇㅈㅊㅋㅌㅍㅎ"[r.charCodeAt(0)-u.charCodeAt(0)]:""].flatMap(t=>{var e;return[...null!==(e=d[t])&&void 0!==e?e:t]})}let I=()=>(t(I.name),t(L[Y(0,L.length-1)])),B=S.flatMap(t=>[...t.normalize("NFC")].flatMap(k)),q=()=>(t(q.name),t(B[Y(0,B.length-1)]));function R(t,e){e.classList.add("no-transition"),t(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.classList.remove("no-transition")})})}j.style.setProperty("--gap","0.75rem"),j.style.setProperty("--width",12),j.style.setProperty("--height",12),R(()=>{for(let t=0;t<144;t++){let t=A.content.cloneNode(!0).querySelector("i"),e=Y(0,1)?I():q();t.dataset.jamo=e,j.appendChild(t)}},j);let z=Array.from({length:144},()=>null),D=(t,e,n,o)=>{if(n<0||n>7)throw RangeError("direction must be 0 to 7");for(let a=-1;a<=1;a++)for(let l=-1;l<=1;l++)if(r[a+1][l+1]===n)return[t+l*o,e+a*o]},T=j.querySelectorAll("#jamo-board>i");T.forEach((t,e)=>{t.dataset.index=e});let F=(t,e,n,r)=>{let o=E(t);if(o.length>12&&o.length>12)throw RangeError("word too long for board");for(let t=0;t<o.length;t++){let[a,l]=D(e,n,r,t);if(a<0||a>=12||l<0||l>=12)return!1;let i=z[12*l+a];if(i&&i!==o[t])return!1}for(let t=0;t<o.length;t++){let[a,l]=D(e,n,r,t),i=o[t],s=12*l+a;z[s]=i,T[s].dataset.jamo=i}return!0};function H(t,e){var n;let r=null!==(n=H.cache)&&void 0!==n?n:H.cache=new Map;if(r.has(t))return r.get(t);let o=e();return r.set(t,o),o}function V(t,e,n,r,o=null){let a=H(V,()=>document.getElementById("completion-bar-template")),l=null!=o?o:a.content.cloneNode(!0).querySelector(".completion-bar");l.dataset.start=`${t},${e}`,l.dataset.end=`${n},${r}`;let i=Math.min(t,n),s=Math.max(t,n),u=Math.min(e,r),c=Math.max(e,r),d=(s-i+1)*2+.75*(s-i),f=(c-u+1)*2+.75*(c-u);return l.style.setProperty("--top",`${2*u+.75*u}rem`),l.style.setProperty("--left",`${2*i+.75*i}rem`),l.style.setProperty("--width",`${d}rem`),l.style.setProperty("--height",`${f}rem`),l.style.setProperty("--thick","2.25rem"),l.style.setProperty("--hypot",`${Math.hypot(d,f)+.25}rem`),l.style.setProperty("--angle",`${180*Math.atan2(Math.sign(r-e)*f,Math.sign(n-t)*d)/Math.PI}deg`),l.style.setProperty("--hue",h+Math.floor(43758.5453*Math.sin(12.9898*t+78.233*e)%1*_)*Math.floor(360/_)),l}j.style.setProperty("--size","2rem");let G=0,J=document.getElementById("stage-clear-dialog"),U=J.querySelector("#next-stage"),W=J.querySelector("#cancel-next-stage");function X(t,e){G++,t.style.setProperty("--hue",e.style.getPropertyValue("--hue")),t.classList.add("found"),16===G&&J.showModal()}function Y(e,n){return t(Y.name),t([e,n]),t(Math.floor(p.random()*(n-e+1))+e)}U.addEventListener("click",()=>{var t,e;o=0;let n=$();b("gameState",N((t=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){var r;r=n[e],e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r})}return t}({},n),e=e={completions:"",stageNumber:n.stageNumber+1},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):(function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n.push.apply(n,r)}return n})(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t))),w()},{passive:!0}),W.addEventListener("click",()=>{J.close()},{passive:!0});let _=16;h=Y(0,359);let K=Array.from({length:4},()=>16),Q=64,Z=()=>{let t=Y(0,Q-1),e=0;for(let n=0;n<4;n++)if(t<(e+=K[n]))return n};try{S.toSorted((t,e)=>E(e).length-E(t).length).forEach(t=>{let e,n,r;let a=0;for(;;){e=Y(0,11),n=Y(0,11);let l=((r=Z())+6)%8;if(F(t,e,n,l)){K[r]--,Q--,16-K[r]>16/3&&(Q-=K[r],K[r]=0);break}if(a>256)throw o++,Error("Failed to populate a word to the board. Try increasing the size of the board or reducing the number of words. Retrying...");a++}})}catch(t){console.error(t),w();return}e&&e.completions.forEach(([t,e,n,r])=>{!function(t,e,n,r){let o=V(t,e,n,r),a=td(tc(t,e,n,r));X(O.querySelector(`li[data-word="${a}"]`),o),j.appendChild(o)}(t,e,n,r)});let tt=document.getElementById("dark-mode-toggle");tt.addEventListener("click",()=>{let t;let e=tt.dataset.mode,n=tt.dataset.modeOptions.split("|"),r=n[(n.indexOf(e)+1)%n.length];t=()=>{tt.dataset.mode=r,document.documentElement.dataset.mode=r},document.startViewTransition?document.startViewTransition(t):t(),localStorage.darkMode=r},{passive:!0});let te=localStorage.darkMode;te&&R(()=>{tt.dataset.mode=te,document.documentElement.dataset.mode=te},tt);let tn=new Proxy({value:!1},{set:(t,e,n)=>{if("value"===e&&"boolean"==typeof n)return Reflect.set(t,e,n)}}),tr=[-1,-1],to=-1,ta=[-1,-1];function tl(t,e){let[n,o]=t,[a,l]=e;if(!(n===a||o===l||Math.abs(n-a)===Math.abs(o-l)))return -1;let[i,s]=[a-n,l-o];return r[Math.sign(s)+1][Math.sign(i)+1]}let ti=null;function ts(){if(!(-1!==tr[0]&&-1!==tr[1]))return;let t=null!==ti,[e,n]=tr,[r,o]=-1===ta[0]&&-1===ta[1]?[e,n]:ta;ti=V(e,n,r,o,ti),t||j.appendChild(ti)}function tu(t,e){let n=t<e?1:-1,r=[];for(let o=0;o<=Math.abs(e-t);o++)r.push(o*n+t);return r}function tc(t,e,n,r){let o=tu(t,n),a=tu(e,r);return Array.from({length:Math.max(o.length,a.length)},(n,r)=>{var l,i;return[null!==(l=o[r])&&void 0!==l?l:t,null!==(i=a[r])&&void 0!==i?i:e]}).map(([t,e])=>T[12*e+t].dataset.jamo).join("")}function td(t){return S.find(e=>{let[n,r]=H(e,()=>{let t=E(e);return[t.join(""),t.toReversed().join("")]});return n===t||r===t})}function th(t,e,n){return t<e?e-t:t>n?t-n:0}function tf(t,e){let[n,r,o,a,l,i]=function(){let t=T[0],e=T[1],n=T[12],r=t.getBoundingClientRect(),o=e.getBoundingClientRect(),a=n.getBoundingClientRect(),l=o.left-r.left,i=a.top-r.top,s=r.left;return[s,r.top,l,i,o.left-r.right,a.top-r.bottom]}(),[s,u]=[t-(n-l/2),e-(r-i/2)],[c,d]=[Math.floor(s/o),Math.floor(u/a)];return[c,d]}function tm(t,e,n){return Math.min(n,Math.max(e,t))}j.addEventListener("pointerdown",t=>{if(t.target.matches("#jamo-board>i")){if(tn.value=!0,(tr=tf(t.clientX,t.clientY))[0]<0||tr[0]>=12||tr[1]<0||tr[1]>=12){tr=[-1,-1];return}ta=[-1,-1],to=-1,ts()}},{passive:!0}),document.addEventListener("pointerup",t=>{C=2===t.button,tn.value=!1,tr[0]===ta[0]&&tr[1]===ta[1]?(null==ti||ti.remove(),ti=null):-1!==ta[0]&&-1!==ta[1]&&function(t){try{if(null===t)return;let[e,n]=t.dataset.start.split(",").map(Number),[r,o]=t.dataset.end.split(",").map(Number);if(e===r&&n===o){t.remove();return}let a=tl([e,n],[r,o]);if(-1===a){t.remove();return}let l=tc(e,n,r,o),i=td(l);if(i){let e=O.querySelector(`li[data-word="${i}"]`);e&&(e.classList.contains("found")?t.remove():X(e,t))}else t.remove()}finally{ti=null}}(ti)},{passive:!0}),document.addEventListener("pointermove",t=>{if(!tn.value)return;t.preventDefault();let e=tf(t.clientX,t.clientY);if(e[0]=tm(e[0],0,11),e[1]=tm(e[1],0,11),tr[0]===e[0]&&tr[1]===e[1])return;let n=tl(tr,e);if(-1!==n?(ta=e,to=n):-1!==ta[0]&&-1!==ta[1]&&(ta=function(t,e,n){let[r,o]=t,[a,l]=e,[i,s]=[a-r,l-o],[u,c]=[a-r,l-o],[d,h]=[a-r,l-o];Math.abs(u)<Math.abs(c)?u=0:c=0,(d+h)%2&&(Math.abs(d)<Math.abs(h)?h-=Math.sign(h):d-=Math.sign(d));{let t=Math.abs(Math.abs(d)-Math.abs(h))/2;Math.abs(d)<Math.abs(h)?(d+=Math.sign(d)*t,h-=Math.sign(h)*t):(d-=Math.sign(d)*t,h+=Math.sign(h)*t)}let f=Math.abs(i-u)+Math.abs(s-c),m=Math.abs(i-d)+Math.abs(s-h);return f===m?n%2==0?[r+u,o+c]:[r+d,o+h]:f<m?[r+u,o+c]:[r+d,o+h]}(tr,e,to)),!(-1!==ta[0]&&-1!==ta[1]))return;let[r,o]=ta;if(r<0||r>=12||o<0||o>=12){let t=tl(tr,[r,o]),e=th(r,0,11),n=th(o,0,11);[r,o]=D(r,o,t,-Math.max(e,n))}T[12*(ta=[r,o])[1]+ta[0]],ts()}),e||b("gameState",N()),window.serializeGameState=N;let tp=document.querySelector("main"),tg=()=>{let t=screen.availWidth,e=screen.availHeight;tp.style.transform="scale(1)",tp.style.margin="0";let{width:n,height:r}=tp.getBoundingClientRect(),o=Math.min(1,t/n,e/r);tp.style.transform=`scale(${o})`,tp.style.margin=`${r*(o-1)/2}px ${n*(o-1)/2}px`};tg(),window.addEventListener("resize",tg,{passive:!0}),window.addEventListener("beforeunload",()=>{b("beforeunload",v("beforeunload",0)+1),v("gameState")&&b("gameState",N())},{passive:!0}),window.addEventListener("pagehide",()=>{b("pagehide",v("pagehide",0)+1)},{passive:!0}),performance.now()})).apply(this,arguments)}function w(){[...document.body.children].filter(t=>t!==document.currentScript).forEach(t=>t.remove()),document.body.innerHTML=r,window.hwgInitialized=!1,g()}function v(t,e){let n=localStorage[t];return"string"==typeof n?JSON.parse(n):null!=e?e:null}function b(t,e){localStorage[t]=JSON.stringify(e)}window.average=function(t){return t.reduce((t,e)=>t+e,0)/t.length},window.median=function(t){let e=t.slice().sort((t,e)=>t-e),n=Math.floor(e.length/2);return e.length%2==0?(e[n-1]+e[n])/2:e[n]},window.getCurrentFunctionName=function(){return Error().stack.split("\n").slice(1)[1].match(/at (\w+)/)[1]},performance.now(),g(),function(){var t;let n=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a","Enter"],r=0,o=(t=e(function*(t){t.key===n[r]?++r===n.length&&(console.log("showing lunatic text"),window.removeEventListener("keydown",o)):r=0}),function(e){return t.apply(this,arguments)});window.addEventListener("keydown",o,{passive:!0})}(),document.getElementById("show-settings-panel").addEventListener("click",()=>{document.getElementById("settings-panel").showModal()})})();

//# sourceMappingURL=js.js.map