function t(t,e,n,r,o,a,l){try{var i=t[a](l),s=i.value}catch(t){n(t);return}i.done?e(s):Promise.resolve(s).then(r,o)}function e(e){return function(){var n=this,r=arguments;return new Promise(function(o,a){var l=e.apply(n,r);function i(e){t(l,o,a,i,s,"next",e)}function s(e){t(l,o,a,i,s,"throw",e)}i(void 0)})}}e(function*(){let t=t=>t,n=(performance.now(),document.currentScript.outerHTML),r=document.body.innerHTML.replace(n,""),o=0;function a(t){return t>=0?2*t:-2*t-1}function l(t){return t%2==0?t/2:-(t+1)/2}function i(){return(i=e(function*(t){let e=yield fetch(t);if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);return yield e.text()})).apply(this,arguments)}function s(t){return u.apply(this,arguments)}function u(){return(u=e(function*(t){return(yield function(t){return i.apply(this,arguments)}(t)).split("\n").filter(t=>!t.startsWith("#")).map(t=>t.trim())})).apply(this,arguments)}t(function(t){let e=function(t){let e=Math.floor((Math.sqrt(8*t+1)-1)/2),n=t-(e*e+e)/2;return[e-n,n]}(a(42));return[l(e[0]),l(e[1])]}(0));let c=yield s("/data/wordsets.txt"),d=[];function h(){return(h=e(function*(t){let e=yield s(`/data/wordsets/${t}.txt`);return d.push(e),e})).apply(this,arguments)}function m(t){return f.apply(this,arguments)}function f(){return(f=e(function*(t){var e;let n=t%c.length;return null!==(e=d[n])&&void 0!==e?e:yield function(t){return h.apply(this,arguments)}(c[n])})).apply(this,arguments)}let p=[],g={s1:0,s2:0,setSeed(t){this.s1=t,this.s2=t},random(){return this.s1=1103515245*this.s1+12345&2147483647,this.s2^=this.s2<<13,this.s2^=this.s2>>17,this.s2^=this.s2<<5,t("random.random"),t(((this.s1^this.s2)+2147483648)/4294967295)}};function y(){return v.apply(this,arguments)}function v(){return(v=e(function*(){let e;if(window.hwgInitialized)throw Error("Game was already initialized.");window.hwgInitialized=!0;let n=document.getElementById("stage"),r=[[3,2,1],[4,-1,0],[5,6,7]],[i,s,u]=[..."각".normalize("NFD")],c=12623-s.charCodeAt(0),d=Object.fromEntries(Object.entries({ㄱㄱ:"ㄲ",ㄱㅅ:"ㄳ",ㄴㅈ:"ㄵ",ㄴㅎ:"ㄶ",ㄷㄷ:"ㄸ",ㄹㄱ:"ㄺ",ㄹㅁ:"ㄻ",ㄹㅂ:"ㄼ",ㄹㅅ:"ㄽ",ㄹㅌ:"ㄾ",ㄹㅍ:"ㄿ",ㄹㅎ:"ㅀ",ㅂㅂ:"ㅃ",ㅂㅅ:"ㅄ",ㅅㅅ:"ㅆ",ㅈㅈ:"ㅉ",ㅏㅣ:"ㅐ",ㅑㅣ:"ㅒ",ㅓㅣ:"ㅔ",ㅕㅣ:"ㅖ",ㅗㅏ:"ㅘ",ㅗㅏㅣ:"ㅙ",ㅗㅣ:"ㅚ",ㅜㅓ:"ㅝ",ㅜㅓㅣ:"ㅞ",ㅜㅣ:"ㅟ",ㅡㅣ:"ㅢ"}).map(([t,e])=>[e,t])),h=-1,f=1;try{(e=function(t){if(null===t)return null;let[e,n]=t.split("|");if(N(e)!==1*n)throw Error("saved game state is corrupted");let r=JSON.parse(e);if(4!==r.GAME_VERSION)throw Error("The saved game state is from a different version of the game.");return r.completions?r.completions=r.completions.split(",").map(Number).reduce((t,e)=>(t.length&&4!==t.at(-1).length||t.push([]),t.at(-1).push(e),t),[]):r.completions=[],r}(w("gameState")))&&(f=e.stageNumber,n.textContent=f)}catch(t){console.error(t),M("gameState")}n.textContent=f,p.length=0,p.push(...yield m(f));let y=function(t,e){let n=a(t),r=a(e);return l(.5*(n+r)*(n+r+1)+r)}(f,o);g.setSeed(y);let v=[...p];function S(t){return[...t.normalize("NFC")].flatMap(B)}let O=[];for(let t=0;t<16;t++)O.push(...v.splice(K(0,v.length-1),1));v.length=0;let P=document.getElementById("word-list"),j=document.getElementById("word-template");O.forEach(t=>{let e=j.content.cloneNode(!0).querySelector("li");e.textContent=t,e.dataset.word=t,P.appendChild(e)});let L=document.getElementById("jamo-board"),C=document.getElementById("jamo-template");L.addEventListener("selectstart",t=>{t.preventDefault()});let $=!1;L.addEventListener("contextmenu",t=>{$||t.preventDefault(),$=!1});let x="ㄱㄴㄷㄹㅁㅂㅅㅇㅈㅊㅋㅌㅍㅎㅏㅑㅓㅕㅗㅛㅜㅠㅡㅣ";function N(t){return[...t].map(t=>t.charCodeAt()).reduce((t,e)=>(t>>>1|(1&t)<<15)^e,0)}function A(){return{GAME_VERSION:4,width:12,height:12,completions:Array.from(L.querySelectorAll(".completion-bar")).filter(t=>t!==ts).map(t=>`${t.dataset.start},${t.dataset.end}`).join(),stageNumber:f}}function I(t=A()){let e=JSON.stringify(t);return`${e}|${N(e)}`}function B(t){let[e,n,r]=[...t.normalize("NFD")].concat(["","",""]).slice(0,3);return["ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌㅍㅎ"[e.charCodeAt(0)-i.charCodeAt(0)],String.fromCharCode(n.charCodeAt(0)+c),r.length?"ㄱㄲㄳㄴㄵㄶㄷㄹㄺㄻㄼㄽㄾㄿㅀㅁㅂㅄㅅㅆㅇㅈㅊㅋㅌㅍㅎ"[r.charCodeAt(0)-u.charCodeAt(0)]:""].flatMap(t=>{var e;return[...null!==(e=d[t])&&void 0!==e?e:t]})}let q=()=>(t(q.name),t(x[K(0,x.length-1)])),k=O.flatMap(t=>[...t.normalize("NFC")].flatMap(B)),z=()=>(t(z.name),t(k[K(0,k.length-1)]));function T(t,e){e.classList.add("no-transition"),t(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.classList.remove("no-transition")})})}L.style.setProperty("--gap","0.75rem"),L.style.setProperty("--width",12),L.style.setProperty("--height",12),T(()=>{for(let t=0;t<144;t++){let t=C.content.cloneNode(!0).querySelector("i"),e=K(0,1)?q():z();t.dataset.jamo=e,L.appendChild(t)}},L);let R=Array.from({length:144},()=>null),D=(t,e,n,o)=>{if(n<0||n>7)throw RangeError("direction must be 0 to 7");for(let a=-1;a<=1;a++)for(let l=-1;l<=1;l++)if(r[a+1][l+1]===n)return[t+l*o,e+a*o]},F=L.querySelectorAll("#jamo-board>i");F.forEach((t,e)=>{t.dataset.index=e});let H=(t,e,n,r)=>{let o=S(t);if(o.length>12&&o.length>12)throw RangeError("word too long for board");for(let t=0;t<o.length;t++){let[a,l]=D(e,n,r,t);if(a<0||a>=12||l<0||l>=12)return!1;let i=R[12*l+a];if(i&&i!==o[t])return!1}for(let t=0;t<o.length;t++){let[a,l]=D(e,n,r,t),i=o[t],s=12*l+a;R[s]=i,F[s].dataset.jamo=i}return!0};function V(t,e){var n;let r=null!==(n=V.cache)&&void 0!==n?n:V.cache=new Map;if(r.has(t))return r.get(t);let o=e();return r.set(t,o),o}function G(t,e,n,r,o=null){let a=V(G,()=>document.getElementById("completion-bar-template")),l=null!=o?o:a.content.cloneNode(!0).querySelector(".completion-bar");l.dataset.start=`${t},${e}`,l.dataset.end=`${n},${r}`;let i=Math.min(t,n),s=Math.max(t,n),u=Math.min(e,r),c=Math.max(e,r),d=(s-i+1)*2+.75*(s-i),m=(c-u+1)*2+.75*(c-u);return l.style.setProperty("--top",`${2*u+.75*u}rem`),l.style.setProperty("--left",`${2*i+.75*i}rem`),l.style.setProperty("--width",`${d}rem`),l.style.setProperty("--height",`${m}rem`),l.style.setProperty("--thick","2.25rem"),l.style.setProperty("--hypot",`${Math.hypot(d,m)+.25}rem`),l.style.setProperty("--angle",`${180*Math.atan2(Math.sign(r-e)*m,Math.sign(n-t)*d)/Math.PI}deg`),l.style.setProperty("--hue",h+Math.floor(43758.5453*Math.sin(12.9898*t+78.233*e)%1*Q)*Math.floor(360/Q)),l}L.style.setProperty("--size","2rem");let J=0,W=document.getElementById("stage-clear-dialog"),X=W.querySelector("#next-stage"),Y=W.querySelector("#cancel-next-stage");function _(t,e){J++,t.style.setProperty("--hue",e.style.getPropertyValue("--hue")),t.classList.add("found"),16===J&&(W.showModal(),m(f+1))}function K(e,n){return t(K.name),t([e,n]),t(Math.floor(g.random()*(n-e+1))+e)}X.addEventListener("click",()=>{var t,e;o=0;let n=A();E("gameState",I((t=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){var r;r=n[e],e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r})}return t}({},n),e=e={completions:"",stageNumber:n.stageNumber+1},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):(function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n.push.apply(n,r)}return n})(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t))),b()},{passive:!0}),Y.addEventListener("click",()=>{W.close()},{passive:!0});let Q=16;h=K(0,359);let U=Array.from({length:4},()=>16),Z=64,tt=()=>{let t=K(0,Z-1),e=0;for(let n=0;n<4;n++)if(t<(e+=U[n]))return n};try{O.toSorted((t,e)=>S(e).length-S(t).length).forEach(t=>{let e,n,r;let a=0;for(;;){e=K(0,11),n=K(0,11);let l=((r=tt())+6)%8;if(H(t,e,n,l)){U[r]--,Z--,16-U[r]>16/3&&(Z-=U[r],U[r]=0);break}if(a>256)throw o++,Error("Failed to populate a word to the board. Try increasing the size of the board or reducing the number of words. Retrying...");a++}})}catch(t){console.error(t),b();return}e&&e.completions.forEach(([t,e,n,r])=>{!function(t,e,n,r){let o=G(t,e,n,r),a=th(td(t,e,n,r));_(P.querySelector(`li[data-word="${a}"]`),o),L.appendChild(o)}(t,e,n,r)});let te=document.getElementById("dark-mode-toggle");te.addEventListener("click",()=>{let t;let e=te.dataset.mode,n=te.dataset.modeOptions.split("|"),r=n[(n.indexOf(e)+1)%n.length];t=()=>{te.dataset.mode=r,document.documentElement.dataset.mode=r},document.startViewTransition?document.startViewTransition(t):t(),localStorage.darkMode=r},{passive:!0});let tn=localStorage.darkMode;tn&&T(()=>{te.dataset.mode=tn,document.documentElement.dataset.mode=tn},te);let tr=new Proxy({value:!1},{set:(t,e,n)=>{if("value"===e&&"boolean"==typeof n)return Reflect.set(t,e,n)}}),to=[-1,-1],ta=-1,tl=[-1,-1];function ti(t,e){let[n,o]=t,[a,l]=e;if(!(n===a||o===l||Math.abs(n-a)===Math.abs(o-l)))return -1;let[i,s]=[a-n,l-o];return r[Math.sign(s)+1][Math.sign(i)+1]}let ts=null;function tu(){if(!(-1!==to[0]&&-1!==to[1]))return;let t=null!==ts,[e,n]=to,[r,o]=-1===tl[0]&&-1===tl[1]?[e,n]:tl;ts=G(e,n,r,o,ts),t||L.appendChild(ts)}function tc(t,e){let n=t<e?1:-1,r=[];for(let o=0;o<=Math.abs(e-t);o++)r.push(o*n+t);return r}function td(t,e,n,r){let o=tc(t,n),a=tc(e,r);return Array.from({length:Math.max(o.length,a.length)},(n,r)=>{var l,i;return[null!==(l=o[r])&&void 0!==l?l:t,null!==(i=a[r])&&void 0!==i?i:e]}).map(([t,e])=>F[12*e+t].dataset.jamo).join("")}function th(t){return O.find(e=>{let[n,r]=V(e,()=>{let t=S(e);return[t.join(""),t.toReversed().join("")]});return n===t||r===t})}function tm(t,e,n){return t<e?e-t:t>n?t-n:0}function tf(t,e){let[n,r,o,a,l,i]=function(){let t=F[0],e=F[1],n=F[12],r=t.getBoundingClientRect(),o=e.getBoundingClientRect(),a=n.getBoundingClientRect(),l=o.left-r.left,i=a.top-r.top,s=r.left;return[s,r.top,l,i,o.left-r.right,a.top-r.bottom]}(),[s,u]=[t-(n-l/2),e-(r-i/2)],[c,d]=[Math.floor(s/o),Math.floor(u/a)];return[c,d]}function tp(t,e,n){return Math.min(n,Math.max(e,t))}L.addEventListener("pointerdown",t=>{if(t.target.matches("#jamo-board>i")){if(tr.value=!0,(to=tf(t.clientX,t.clientY))[0]<0||to[0]>=12||to[1]<0||to[1]>=12){to=[-1,-1];return}tl=[-1,-1],ta=-1,tu()}},{passive:!0}),document.addEventListener("pointerup",t=>{$=2===t.button,tr.value=!1,to[0]===tl[0]&&to[1]===tl[1]?(null==ts||ts.remove(),ts=null):-1!==tl[0]&&-1!==tl[1]&&function(t){try{if(null===t)return;let[e,n]=t.dataset.start.split(",").map(Number),[r,o]=t.dataset.end.split(",").map(Number);if(e===r&&n===o){t.remove();return}let a=ti([e,n],[r,o]);if(-1===a){t.remove();return}let l=td(e,n,r,o),i=th(l);if(i){let e=P.querySelector(`li[data-word="${i}"]`);e&&(e.classList.contains("found")?t.remove():_(e,t))}else t.remove()}finally{ts=null}}(ts)},{passive:!0}),document.addEventListener("pointermove",t=>{if(!tr.value)return;t.preventDefault();let e=tf(t.clientX,t.clientY);if(e[0]=tp(e[0],0,11),e[1]=tp(e[1],0,11),to[0]===e[0]&&to[1]===e[1])return;let n=ti(to,e);if(-1!==n?(tl=e,ta=n):-1!==tl[0]&&-1!==tl[1]&&(tl=function(t,e,n){let[r,o]=t,[a,l]=e,[i,s]=[a-r,l-o],[u,c]=[a-r,l-o],[d,h]=[a-r,l-o];Math.abs(u)<Math.abs(c)?u=0:c=0,(d+h)%2&&(Math.abs(d)<Math.abs(h)?h-=Math.sign(h):d-=Math.sign(d));{let t=Math.abs(Math.abs(d)-Math.abs(h))/2;Math.abs(d)<Math.abs(h)?(d+=Math.sign(d)*t,h-=Math.sign(h)*t):(d-=Math.sign(d)*t,h+=Math.sign(h)*t)}let m=Math.abs(i-u)+Math.abs(s-c),f=Math.abs(i-d)+Math.abs(s-h);return m===f?n%2==0?[r+u,o+c]:[r+d,o+h]:m<f?[r+u,o+c]:[r+d,o+h]}(to,e,ta)),!(-1!==tl[0]&&-1!==tl[1]))return;let[r,o]=tl;if(r<0||r>=12||o<0||o>=12){let t=ti(to,[r,o]),e=tm(r,0,11),n=tm(o,0,11);[r,o]=D(r,o,t,-Math.max(e,n))}F[12*(tl=[r,o])[1]+tl[0]],tu()}),e||E("gameState",I()),window.serializeGameState=I;let tg=document.querySelector("main"),ty=()=>{let t=screen.availWidth,e=screen.availHeight;tg.style.transform="scale(1)",tg.style.margin="0";let{width:n,height:r}=tg.getBoundingClientRect(),o=Math.min(1,t/n,e/r);tg.style.transform=`scale(${o})`,tg.style.margin=`${r*(o-1)/2}px ${n*(o-1)/2}px`};ty(),window.addEventListener("resize",ty,{passive:!0}),window.addEventListener("beforeunload",()=>{E("beforeunload",w("beforeunload",0)+1),w("gameState")&&E("gameState",I())},{passive:!0}),window.addEventListener("pagehide",()=>{E("pagehide",w("pagehide",0)+1)},{passive:!0}),document.getElementById("show-settings-panel").addEventListener("click",()=>{document.getElementById("settings-panel").showModal()});let tv=null,tb=document.getElementById("clear-game-state");tb.addEventListener("pointerdown",()=>{tv=setTimeout(()=>{M("gameState"),location.reload()},2e3)}),tb.addEventListener("pointerup",()=>{clearTimeout(tv)}),tb.addEventListener("pointerleave",()=>{clearTimeout(tv)}),document.querySelectorAll("form[method=dialog]>button[type=submit]").forEach(t=>{t.addEventListener("click",e=>{var n,r;e.preventDefault(),null===(r=t.closest("dialog"))||void 0===r||null===(n=r.close)||void 0===n||n.call(r)})}),performance.now()})).apply(this,arguments)}function b(){[...document.body.children].filter(t=>t!==document.currentScript).forEach(t=>t.remove()),document.body.innerHTML=r,window.hwgInitialized=!1,y()}function w(t,e){let n=localStorage[t];return"string"==typeof n?JSON.parse(n):null!=e?e:null}function M(t){delete localStorage[t]}function E(t,e){localStorage[t]=JSON.stringify(e)}performance.now(),y()})();

//# sourceMappingURL=js.js.map